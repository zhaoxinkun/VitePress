# Lifecycle Hooks

<!-- ## ç›®å½•

- [Lifecycle Hooks](#lifecycle-hooks)
  - [ç›®å½•](#ç›®å½•)
  - [åˆ›å»ºé˜¶æ®µï¼ˆCreation Phaseï¼‰](#åˆ›å»ºé˜¶æ®µcreation-phase)
    - [`beforeCreateï¼ˆåˆ›å»ºå‰ï¼‰ï¼š`](#beforecreateåˆ›å»ºå‰)
    - [`createdï¼ˆåˆ›å»ºåï¼‰ï¼š`](#createdåˆ›å»ºå)
  - [æŒ‚è½½é˜¶æ®µï¼ˆMounting Phaseï¼‰](#æŒ‚è½½é˜¶æ®µmounting-phase)
    - [`beforeMountï¼ˆæŒ‚è½½å‰ï¼‰ï¼š`](#beforemountæŒ‚è½½å‰)
    - [`mountedï¼ˆæŒ‚è½½åï¼‰ï¼š`](#mountedæŒ‚è½½å)
  - [æ›´æ–°é˜¶æ®µï¼ˆUpdating Phaseï¼‰](#æ›´æ–°é˜¶æ®µupdating-phase)
    - [`beforeUpdateï¼ˆæ›´æ–°å‰ï¼‰ï¼š`](#beforeupdateæ›´æ–°å‰)
    - [`updatedï¼ˆæ›´æ–°åï¼‰ï¼š`](#updatedæ›´æ–°å)
  - [é”€æ¯é˜¶æ®µï¼ˆDestroying Phaseï¼‰](#é”€æ¯é˜¶æ®µdestroying-phase)
    - [`beforeDestroyï¼ˆé”€æ¯å‰ï¼‰ï¼š`](#beforedestroyé”€æ¯å‰)
    - [`destroyedï¼ˆé”€æ¯åï¼‰ï¼š`](#destroyedé”€æ¯å)
  - [`keep-alive`ç»„ä»¶](#keep-aliveç»„ä»¶)
    - [`activatedï¼ˆkeep-aliveï¼‰æ¿€æ´»æ—¶ï¼š`](#activatedkeep-aliveæ¿€æ´»æ—¶)
    - [`deactivatedï¼ˆkeep-aliveï¼‰å¤±æ´»æ—¶ï¼š`](#deactivatedkeep-aliveå¤±æ´»æ—¶)
  - [é”™è¯¯æ•è·ï¼ˆError Handling Phaseï¼‰](#é”™è¯¯æ•è·error-handling-phase)
    - [`errorCaptured`](#errorcaptured)
  - [å¼€å‘è€…æ¨¡å¼](#å¼€å‘è€…æ¨¡å¼)
    - [`renderTracked `](#rendertracked-)
    - [`renderTriggered`](#rendertriggered)
  - [æœåŠ¡ç«¯æ¸²æŸ“](#æœåŠ¡ç«¯æ¸²æŸ“)
    - [`serverPrefetch `](#serverprefetch-)
  - [çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­æ‰§è¡Œé¡ºåº](#çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­æ‰§è¡Œé¡ºåº)
  - [çˆ¶ç»„ä»¶èƒ½ç›‘å¬åˆ°å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå—](#çˆ¶ç»„ä»¶èƒ½ç›‘å¬åˆ°å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå—)
    - [æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ï¼ˆ`$emit`ï¼‰](#æ–¹æ³•ä¸€ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶emit)
    - [æ–¹æ³•äºŒï¼šä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰](#æ–¹æ³•äºŒä½¿ç”¨äº‹ä»¶æ€»çº¿event-bus)
    - [æ–¹æ³•ä¸‰ï¼šè°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•](#æ–¹æ³•ä¸‰è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•) -->

> ğŸ“Œæ¯ä¸ª Vue å®ä¾‹åœ¨è¢«åˆ›å»ºæ—¶éƒ½è¦ç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–è¿‡ç¨‹â€”â€”ä¾‹å¦‚ï¼Œéœ€è¦è®¾ç½®æ•°æ®ç›‘å¬ã€ç¼–è¯‘æ¨¡æ¿ã€å°†å®ä¾‹æŒ‚è½½åˆ° `DOM` å¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° `DOM `ç­‰ã€‚åŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šè¿è¡Œä¸€äº›å«åš**ç”Ÿå‘½å‘¨æœŸé’©å­**çš„å‡½æ•°ï¼Œè¿™ç»™äº†ç”¨æˆ·åœ¨ä¸åŒé˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç çš„æœºä¼šã€‚

ä¸è¦åœ¨é€‰é¡¹ `property `æˆ–å›è°ƒä¸Šä½¿ç”¨[ç®­å¤´å‡½æ•°](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions "ç®­å¤´å‡½æ•°")ï¼Œæ¯”å¦‚ `created: () => console.log(this.a)` æˆ– `vm.$watch('a', newValue => this.myMethod())`ã€‚å› ä¸ºç®­å¤´å‡½æ•°å¹¶æ²¡æœ‰ `this`ï¼Œ`this` ä¼šä½œä¸ºå˜é‡ä¸€ç›´å‘ä¸Šçº§è¯æ³•ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç›´è‡³æ‰¾åˆ°ä¸ºæ­¢ï¼Œç»å¸¸å¯¼è‡´ `Uncaught TypeError: Cannot read property of undefined` æˆ– `Uncaught TypeError: this.myMethod is not a function` ä¹‹ç±»çš„é”™è¯¯ã€‚

![](image/image_n1lPC7AHd6.png)

![](image/ç”Ÿå‘½å‘¨æœŸ_6bv6V4vy_O.png)

```javascript
const vm = new Vue({
    el:"#app",
    beforeCreate() {
        /*å¤‡å­•*/
        console.log("å®ä¾‹åˆ›å»ºä¹‹å‰")
    },
    created() {
        /*æ€€ä¸Šäº†*/
        // æ•°æ®è¯·æ±‚
        console.log("å®ä¾‹åˆ›å»ºä¹‹å")
    },
    beforeMount() {
        /*å¿«ç”Ÿäº†*/
        console.log("æŒ‚è½½åˆ°é¡µé¢ä¹‹å‰")
    },
    mounted() {
        /*ç”Ÿäº†*/
        // æ•°æ®è¯·æ±‚ï¼ŒDOMæ“ä½œï¼Œç›‘å¬æ»šåŠ¨äº‹ä»¶...
        console.log("æŒ‚è½½åˆ°é¡µé¢ä¹‹å")
    },
    beforeUpdate() {
        /*å¿«é•¿å¤§äº†*/
        console.log("æ•°æ®æ›´æ–°ä¹‹å‰")
    },
    updated() {
        /*é•¿å¤§äº†*/
        // DOMæ“ä½œï¼Œå®ä¾‹åŒ–çš„æ“ä½œ...
        console.log("æ•°æ®æ›´æ–°ä¹‹å")
    },
    beforeDestroy() {
        /*è¦æŒ‚äº†*/
        // å–æ¶ˆæ•°æ®è®¢é˜…
        console.log("å®ä¾‹é”€æ¯ä¹‹å‰")
    },
    destroyed() {
        /*æŒ‚äº†*/
        console.log("å®ä¾‹é”€æ¯ä¹‹å")
    }
})
```

```javascript
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        
    </style>
</head>
<body>
    <div id="app">
        <input type="text" v-model="txt"><span>{{txt}}</span>
        <button @click="del" ref="b">é”€æ¯å½“å‰å®ä¾‹</button>
    </div>
</body>
<script src="../libs/vue.js"></script>
<script>

    new Vue({
        el:"#app",
        data:{
            txt:"hello"
        },
        methods:{
            del(){
                // ä¸»åŠ¨é”€æ¯å½“å‰å®ä¾‹
                this.$destroy();
            }
        },
        beforeCreate() {
            // æ— æ³•é€šè¿‡å®ä¾‹è·å–åˆ°ç»“æ„ä¸­çš„å…ƒç´ 
            // è¿˜å¯ä»¥åœ¨æ­¤å¤„åšä¸€äº›æƒé™æ‹¦æˆª
            // æå‰ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œå‡†å¤‡è¢«å…¶ä»–ç»„ä»¶è§¦å‘ï¼Œç”¨æ¥æ¥æ”¶æ•°æ®
            console.log("å®ä¾‹åˆ›å»ºä¹‹å‰", this.$refs.b);
        },
        created() {
            // æ— æ³•é€šè¿‡å®ä¾‹è·å–åˆ°ç»“æ„ä¸­çš„å…ƒç´ 
            // è¿˜å¯ä»¥åšä¸€äº›å¼‚æ­¥çš„æ•°æ®è¯·æ±‚å¤„ç†æ“ä½œ
            // æå‰ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ï¼Œå‡†å¤‡è¢«å…¶ä»–ç»„ä»¶è§¦å‘ï¼Œç”¨æ¥æ¥æ”¶æ•°æ®
            console.log("å®ä¾‹åˆ›å»ºä¹‹å", this.$refs.b);
        },
        beforeMount() {
            // æ— æ³•é€šè¿‡å®ä¾‹è·å–åˆ°ç»“æ„ä¸­çš„å…ƒç´ 
            // è¿˜å¯ä»¥åšä¸€äº›å¼‚æ­¥çš„æ•°æ®è¯·æ±‚å¤„ç†æ“ä½œ
            // è§¦å‘åˆ«çš„ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œç”¨æ¥å‘é€æ•°æ®
            console.log("å®ä¾‹æŒ‚è½½åˆ°é¡µé¢ä¹‹å‰", this.$refs.b)
        },
        mounted() {
            // å¯ä»¥é€šè¿‡å®ä¾‹è·å–åˆ°ç»“æ„ä¸­çš„å…ƒç´ ï¼ˆæ“ä½œDOMï¼‰
            // è¿˜å¯ä»¥åšä¸€äº›å¼‚æ­¥çš„æ•°æ®è¯·æ±‚å¤„ç†æ“ä½œ
            // è§¦å‘åˆ«çš„ç»„ä»¶çš„è‡ªå®šä¹‰äº‹ä»¶ï¼Œç”¨æ¥å‘é€æ•°æ®
            console.log("å®ä¾‹æŒ‚è½½åˆ°é¡µé¢ä¹‹å", this.$refs.b)
        },
        beforeUpdate() {
            // ç›‘å¬å½“å‰å®ä¾‹çš„å˜åŒ–ï¼Œåšå‡ºä¸åŒçš„å“åº”ï¼ˆæ²¡æœ‰watchå¥½ç”¨ï¼‰
            console.log("å®ä¾‹ä¸­çš„æ•°æ®æˆ–è§†å›¾æ›´æ–°ä¹‹å‰")
        },
        updated() {
            // ç›‘å¬å½“å‰å®ä¾‹çš„å˜åŒ–ï¼Œåšå‡ºä¸åŒçš„å“åº”ï¼ˆæ²¡æœ‰watchå¥½ç”¨ï¼‰
            console.log("å®ä¾‹ä¸­çš„æ•°æ®æˆ–è§†å›¾æ›´æ–°ä¹‹å")
        },
        beforeDestroy() {
            // é”€æ¯ä¹‹å‰ï¼Œå¯ä»¥å°†ä¹‹å‰æ³¨å†Œè¿‡çš„æ•°æ®æˆ–ç»“æ„æˆ–åŠŸèƒ½æˆ–ç»‘å®šï¼Œæå‰è¿›è¡Œè§£ç»‘
            console.log("å®ä¾‹é”€æ¯ä¹‹å‰");
        },
        destroyed() {
            // å¼€å¯æ–°çš„å®ä¾‹ï¼Œæ–°çš„åŠŸèƒ½
            console.log("å®ä¾‹é”€æ¯ä¹‹å");
        }
    })

    // åŸºæœ¬è¯­æ³•ï¼š
    // æ¯ä¸ªç”Ÿå‘½å‘¨æœŸçš„é’©å­å‡½æ•°éƒ½æ˜¯ç›´æ¥å†™ç»™vueå®ä¾‹çš„é€‰é¡¹
    // å’Œdataï¼Œmethodsï¼Œwatchï¼ŒcomputedåŒçº§
    // ä½†æ˜¯é’©å­å‡½æ•°æ˜¯å‡½æ•°ï¼ï¼ï¼
    // dataï¼Œmethodsï¼Œwatchï¼Œcomputedéƒ½æ˜¯å¯¹è±¡ï¼ï¼ï¼

</script>
</html>
```

## åˆ›å»ºé˜¶æ®µï¼ˆCreation Phaseï¼‰

### `beforeCreateï¼ˆåˆ›å»ºå‰ï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨å®ä¾‹åˆå§‹åŒ–ä¹‹åã€æ•°æ®è§‚æµ‹ (data observation) å’Œ `event`/`watcher `äº‹ä»¶é…ç½®ä¹‹å‰è¢«è°ƒç”¨ã€‚`_data`éƒ½æ²¡æœ‰å‘¢
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µï¼Œå®ä¾‹è¿˜æœªåˆå§‹åŒ–ï¼Œæ— æ³•è®¿é—® `data` å’Œ `methods`ã€‚
- **æ³¨æ„äº‹é¡¹ï¼š** é€‚åˆæ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚è®¾ç½®åˆå§‹æ•°æ®ã€æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ç­‰ã€‚é€šå¸¸ç”¨äºåˆå§‹åŒ–éå“åº”å¼çš„æ•°æ®ã€‚

```javascript
export default {
  beforeCreate() {
    console.log('beforeCreate');
    // æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ
    this.message = 'Hello, Vue!';
    debugger;  //æƒ³è¦è§‚å¯Ÿï¼Œå°±è¦åœ¨è¿™é‡Œåœä¸‹
  },
  data() {
    return {
      message: ''
    }
  }
}
```

### `createdï¼ˆåˆ›å»ºåï¼‰ï¼š`

- **ä½œç”¨ï¼š** å®ä¾‹å·²ç»åˆ›å»ºå®Œæˆä¹‹åè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹å·²å®Œæˆä»¥ä¸‹çš„é…ç½®ï¼šæ•°æ®è§‚æµ‹(data observer)ï¼Œå±æ€§å’Œæ–¹æ³•çš„è¿ç®—ï¼Œ`watch`/`event `äº‹ä»¶å›è°ƒã€‚
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µï¼Œå¯ä»¥è®¿é—® `data` å’Œ `methods`ï¼Œä½†è™šæ‹ŸDOMå’ŒæŒ‚è½½é˜¶æ®µè¿˜æœªå¼€å§‹ã€‚
- **æœ¬äººæ¨èåœ¨ created é’©å­å‡½æ•°ä¸­è°ƒç”¨å¼‚æ­¥è¯·æ±‚ï¼Œå› ä¸ºåœ¨ created é’©å­å‡½æ•°ä¸­è°ƒç”¨å¼‚æ­¥è¯·æ±‚æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š**
  - èƒ½æ›´å¿«è·å–åˆ°æœåŠ¡ç«¯æ•°æ®ï¼Œå‡å°‘é¡µé¢Â loading æ—¶é—´ï¼›
  - ssrÂ ä¸æ”¯æŒ beforeMount ã€mounted é’©å­å‡½æ•°ï¼Œæ‰€ä»¥æ”¾åœ¨ created ä¸­æœ‰åŠ©äºä¸€è‡´æ€§ï¼›
- **æ³¨æ„äº‹é¡¹ï¼š** é€‚åˆè¿›è¡Œæ•°æ®å¤„ç†ã€å¼‚æ­¥æ“ä½œã€è°ƒç”¨APIï¼Œå¼‚æ­¥è¯·æ±‚ç­‰æ“ä½œã€‚

```javascript
export default {
  created() {
    console.log('created');
    // å‘èµ·å¼‚æ­¥è¯·æ±‚
    fetch('https://api.example.com/data')
      .then(response => response.json())
      .then(data => {
        this.message = data.message;
      });
  },
  data() {
    return {
      message: ''
    }
  }
}
```

## æŒ‚è½½é˜¶æ®µï¼ˆMounting Phaseï¼‰

### `beforeMountï¼ˆæŒ‚è½½å‰ï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨**æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨**ï¼Œå³å°†å¼€å§‹ç¼–è¯‘æ¨¡æ¿ã€æŠŠæ•°æ®æ¸²æŸ“åˆ°æ¨¡æ¿ä¸­ã€‚
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µï¼Œæ¨¡æ¿ç¼–è¯‘å·²å®Œæˆï¼Œä½†æœªå°†ç»„ä»¶æŒ‚è½½åˆ°`DOM`ï¼ŒæŒ‚è½½é˜¶æ®µå°šæœªå¼€å§‹ã€‚ä½ å¯¹äº`DOM`çš„æ“ä½œï¼Œæ“ä½œä¹Ÿæ˜¯ç™½æ“ä½œ
- **æ³¨æ„äº‹é¡¹ï¼š** é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›å‡†å¤‡å·¥ä½œï¼Œå¦‚ä¿®æ”¹æ•°æ®ç­‰ã€‚

```javascript
export default {
  beforeMount() {
    console.log('beforeMount');
    // æ‰§è¡Œä¸€äº›DOMæ“ä½œ
    this.$refs.myElement.innerHTML = 'Hello, Vue!';
  },
  mounted() {
    // ...
  }
}
```

### `mountedï¼ˆæŒ‚è½½åï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨æŒ‚è½½åˆ°`DOM`å®Œæˆåè¢«è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ¨¡æ¿æ¸²æŸ“æˆhtmlå¹¶è¢«æ’å…¥åˆ°é¡µé¢ä¸­ä¹‹åï¼Œmountedå‡½æ•°å°±ä¼šè¢«è§¦å‘æ‰§è¡Œã€‚æ­¤æ—¶\*\*ç»„ä»¶`DOM `****å·²ç»æ¸²æŸ“å®Œæˆï¼Œå¯ä»¥æ“ä½œçœŸå®çš„ ****`DOM`****ï¼ˆé¿å…ï¼‰ã€‚è¿›è¡Œ****`DOM`\*\***æ“ä½œæˆ–å‘èµ·å¼‚æ­¥è¯·æ±‚ã€‚**
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µï¼Œç»„ä»¶å·²ç»è¢«æŒ‚è½½åˆ° `DOM`ï¼Œå¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„ `$el`ã€‚
  - å‘èµ·å¼‚æ­¥è¯·æ±‚ã€‚ å‘é€`ajax`è¯·æ±‚
  - å¯åŠ¨å®šæ—¶å™¨ã€ç»‘å®šè‡ªå®šä¹‰äº‹ä»¶ã€è®¢é˜…æ¶ˆæ¯ã€äº‹ä»¶ç›‘å¬ç­‰ã€åˆå§‹åŒ–æ“ä½œã€‘
  - åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“æˆ–æ’ä»¶ï¼šé€šå¸¸åœ¨`mounted`å‡½æ•°ä¸­ä¼šåˆå§‹åŒ–ä¸€äº›ç¬¬ä¸‰æ–¹åº“æˆ–æ’ä»¶ï¼Œæ¯”å¦‚`echarts`ã€`swiper`ã€`video.js`ç­‰ç­‰ã€‚
- **æ³¨æ„äº‹é¡¹ï¼š** é€šå¸¸ç”¨äºæ‰§è¡Œä¸€äº›éœ€è¦ `DOM `å…ƒç´ çš„æ“ä½œï¼Œå¦‚å¯åŠ¨å®šæ—¶å™¨ã€å‘èµ·ç½‘ç»œè¯·æ±‚ç­‰ã€‚

```javascript
export default {
  mounted() {
    console.log('mounted');
    // åˆå§‹åŒ–é¡µé¢
    this.$nextTick(() => {
      // è·å–DOMå…ƒç´ 
      const element = document.getElementById('myElement');
      // ...
    });
  }
}
```

## æ›´æ–°é˜¶æ®µï¼ˆUpdating Phaseï¼‰

### `beforeUpdateï¼ˆæ›´æ–°å‰ï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨**æ•°æ®æ›´æ–°ä¹‹å‰è°ƒç”¨**ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿ `DOM `æ‰“è¡¥ä¸ä¹‹å‰ã€‚å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­è¿›ä¸€æ­¥åœ°æ›´æ”¹çŠ¶æ€ï¼Œä¸ä¼šè§¦å‘å…¶ä»–çš„æ¸²æŸ“é’©å­å‡½æ•°ã€‚
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µå¯ä»¥è®¿é—®æ›´æ–°å‰çš„çŠ¶æ€ï¼Œä½†ä¸èƒ½æ‰‹åŠ¨ä¿®æ”¹æ•°æ®ã€‚æ•°æ®æ˜¯æ–°çš„ï¼Œä½†æ˜¯æ˜¾ç¤ºçš„è¿˜æ˜¯æ—§çš„
- **æ³¨æ„äº‹é¡¹ï¼š** é¿å…åœ¨æ­¤é’©å­å‡½æ•°ä¸­ä¿®æ”¹æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯æ›´æ–°ã€‚

```javascript
export default {
  beforeUpdate() {
    console.log('beforeUpdate');
    // æ‰§è¡Œä¸€äº›å‡†å¤‡å·¥ä½œ
    this.previousMessage = this.message;
  },
  updated() {
    // ...
  }
}
```

### `updatedï¼ˆæ›´æ–°åï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨æ•°æ®æ›´æ–°å®Œæˆæ—¶è°ƒç”¨ã€‚åœ¨ç”±äºæ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹Ÿ `DOM `é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹åè°ƒç”¨ï¼Œ**ç»„ä»¶domå·²ç»é‡æ–°æ¸²æŸ“ã€‚**
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µå¯ä»¥è®¿é—®åˆ°æ›´æ–°åçš„çŠ¶æ€ï¼Œ`DOM `å·²ç»é‡æ–°æ¸²æŸ“ã€‚
- **æ³¨æ„äº‹é¡¹ï¼š** é¿å…åœ¨æ­¤é’©å­å‡½æ•°ä¸­ä¿®æ”¹æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯æ›´æ–°ã€‚

```javascript
export default {
  updated() {
    console.log('updated');
    // æ‰§è¡Œä¸€äº›DOMæ“ä½œæˆ–å¤„ç†æ•°æ®
    this.$refs.myElement.innerHTML = 'Updated!';
  }
}
```

## é”€æ¯é˜¶æ®µï¼ˆDestroying Phaseï¼‰

### `beforeDestroyï¼ˆé”€æ¯å‰ï¼‰ï¼š`

- **ä½œç”¨ï¼š****åœ¨å®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹ä»ç„¶å®Œå…¨å¯ç”¨ã€‚** å¯ä»¥è®¿é—®å’Œæ“ä½œç»„ä»¶çš„å±æ€§å’Œæ–¹æ³•ã€‚ä½†åœ¨`destroyed `é’©å­å‡½æ•°ä¹‹åï¼Œç»„ä»¶å®ä¾‹å·²ç»è¢«å®Œå…¨é”€æ¯ï¼Œæ— æ³•å†è®¿é—®å…¶å±æ€§å’Œæ–¹æ³•ã€‚
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** åœ¨æ­¤é˜¶æ®µå¯ä»¥è¿›è¡Œæ¸…ç†å·¥ä½œã€æ”¶å°¾å·¥ä½œã€‘ä»¥é¿å…å†…å­˜æ³„æ¼æˆ–ä¸å¿…è¦çš„èµ„æºå ç”¨ã€‚
  - å–æ¶ˆè®¢é˜…ï¼šå¦‚æœç»„ä»¶åœ¨è®¢é˜…äº†æŸäº›äº‹ä»¶æˆ–æ¶ˆæ¯åï¼Œéœ€è¦åœ¨é”€æ¯å‰å–æ¶ˆè®¢é˜…ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼ã€‚
  - æ¸…é™¤å®šæ—¶å™¨ï¼šå¦‚æœç»„ä»¶åœ¨ä½¿ç”¨å®šæ—¶å™¨æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œåº”è¯¥åœ¨é”€æ¯å‰æ¸…é™¤è¿™äº›å®šæ—¶å™¨ï¼Œä»¥é¿å…èµ„æºæµªè´¹ã€‚
  - è§£ç»‘äº‹ä»¶ç›‘å¬å™¨ï¼šå¦‚æœç»„ä»¶åœ¨ç»‘å®šäº†äº‹ä»¶ç›‘å¬å™¨åï¼Œéœ€è¦åœ¨é”€æ¯å‰è§£ç»‘è¿™äº›äº‹ä»¶ç›‘å¬å™¨ï¼Œä»¥å…é€ æˆäº‹ä»¶æ³„æ¼ã€‚
  - æ¸…é™¤å…¶ä»–èµ„æºï¼šæ ¹æ®ç»„ä»¶ä½¿ç”¨çš„å…·ä½“æƒ…å†µï¼Œå¯èƒ½è¿˜éœ€è¦æ¸…é™¤å…¶ä»–çš„èµ„æºï¼Œä¾‹å¦‚å…³é—­ç½‘ç»œè¿æ¥ã€é‡Šæ”¾å ç”¨çš„å†…å­˜ç­‰ã€‚
- **æ³¨æ„äº‹é¡¹ï¼š** åœ¨æ­¤é˜¶æ®µä»ç„¶å¯ä»¥è®¿é—®å®ä¾‹å’Œæ•°æ®ï¼Œä½†ä¸ä¼šå†è§¦å‘æ›´æ–°ã€‚ä¸€èˆ¬ä¸ä¼šåœ¨`beforeDestroy`æ“ä½œæ•°æ®ï¼Œå› ä¸ºå³ä¾¿æ“ä½œæ•°æ®ï¼Œä¹Ÿä¸ä¼šå†è§¦å‘æ›´æ–°æµç¨‹äº†ã€‚

```javascript
export default {
  beforeDestroy() {
    console.log('beforeDestroy');
    // æ¸…ç†æ“ä½œ
    this.cleanup();
  },
  methods: {
    cleanup() {
      // ...
    }
  }
}
```

### `destroyedï¼ˆé”€æ¯åï¼‰ï¼š`

- **ä½œç”¨ï¼š** åœ¨å®ä¾‹é”€æ¯åè°ƒç”¨ã€‚é”€æ¯åè‡ªå®šä¹‰äº‹ä»¶ä¼šå¤±æ•ˆ,æ‰€æœ‰æŒ‡ä»¤éƒ½è¢«è§£ç»‘ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨å’Œ `watch `ç›‘å¬å™¨éƒ½è¢«è§£ç»‘ï¼Œå­å®ä¾‹ä¹Ÿè¢«é”€æ¯ã€‚ä½†åŸç”Ÿ`DOM`äº‹ä»¶ä¾ç„¶æœ‰æ•ˆã€‚é”€æ¯åå€ŸåŠ©Vueå¼€å‘è€…å·¥å…·çœ‹ä¸åˆ°ä»»ä½•ä¿¡æ¯
- **å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š** æ­¤æ—¶ç»„ä»¶å®ä¾‹åŠå…¶ç›¸å…³çš„ç›‘å¬å™¨å’Œå­ç»„ä»¶éƒ½å·²è¢«é”€æ¯ï¼Œæ— æ³•å†è®¿é—®å®ä¾‹ã€‚
- **æ³¨æ„äº‹é¡¹ï¼š** ä¸å†è®¿é—®ç»„ä»¶å®ä¾‹å’Œ`DOM`å…ƒç´ ï¼Œé€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºï¼Œæ¸…ç†å‰¯ä½œç”¨ã€‚

```javascript
export default {
  destroyed() {
    console.log('destroyed');
    // æ‰§è¡Œæœ€ç»ˆæ¸…ç†æ“ä½œ
    this.releaseResources();
  },
  methods: {
    releaseResources() {
      // ...
    }
  }
}
```

## `keep-alive`ç»„ä»¶

### `activatedï¼ˆkeep-aliveï¼‰æ¿€æ´»æ—¶ï¼š`

- åœ¨ä½¿ç”¨ `<keep-alive>` åŒ…è£¹çš„ç»„ä»¶è¢«æ¿€æ´»æ—¶è°ƒç”¨ã€‚
- æ‰§è¡Œä¸€äº›åœ¨ç»„ä»¶è¢«æ¿€æ´»æ—¶éœ€è¦è¿›è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚æ•°æ®é‡æ–°åŠ è½½ã€åŠ¨ç”»å¼€å§‹ç­‰ã€‚å¯ä»¥æ‰§è¡Œç‰¹å®šäºæ¿€æ´»çŠ¶æ€çš„é€»è¾‘æˆ–è¯·æ±‚æ•°æ®ã€‚

```javascript
export default {
  activated() {
    console.log('activated');
    // æ‰§è¡Œæ¿€æ´»æ—¶çš„æ“ä½œ
    this.loadData();
  },
  methods: {
    loadData() {
      // ...
    }
  }
}
```

### `deactivatedï¼ˆkeep-aliveï¼‰å¤±æ´»æ—¶ï¼š`

- åœ¨ä½¿ç”¨ `<keep-alive>` åŒ…è£¹çš„ç»„ä»¶è¢«åœç”¨æ—¶è°ƒç”¨ã€‚
- å¯ä»¥æ‰§è¡Œç‰¹å®šäºåœç”¨çŠ¶æ€çš„é€»è¾‘æˆ–æ¸…ç†æ“ä½œã€‚

```javascript
export default {
  deactivated() {
    console.log('deactivated');
    // æ‰§è¡Œåœç”¨æ—¶çš„æ“ä½œ
    this.cleanup();
  },
  methods: {
    cleanup() {
      // ...
    }
  }
}
```

è¿™äº›è¯¦ç»†è§£é‡Šå’Œç¤ºä¾‹åº”è¯¥å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£æ¯ä¸ª`Vue`ç”Ÿå‘½å‘¨æœŸé’©å­çš„ä½œç”¨å’Œç”¨æ³•ã€‚é€šè¿‡åˆç†åœ°åˆ©ç”¨è¿™äº›é’©å­å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä»è€Œå®ç°æ›´å¤æ‚çš„åŠŸèƒ½å’Œäº¤äº’æ•ˆæœã€‚

å½“ç»„ä»¶è¢«åˆ›å»ºã€æŒ‚è½½ã€æ›´æ–°æˆ–é”€æ¯æ—¶ï¼Œå¯¹åº”çš„é’©å­å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨è¿™äº›é’©å­å‡½æ•°ä¸­æ‰§è¡Œç›¸åº”çš„é€»è¾‘å’Œæ“ä½œã€‚è¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸ºä½ æä¾›äº†åœ¨ä¸åŒé˜¶æ®µå¤„ç†æ•°æ®ã€`DOM`æ“ä½œã€å¼‚æ­¥è¯·æ±‚ç­‰çš„æœºä¼šã€‚

## é”™è¯¯æ•è·ï¼ˆError Handling Phaseï¼‰

### `errorCaptured`

> 2.5.0+ æ–°å¢

**ç±»å‹**ï¼š`(err: Error, vm: Component, info: string) => ?boolean`

**è¯¦ç»†**ï¼šå½“æ•è·ä¸€ä¸ªæ¥è‡ªå­å­™ç»„ä»¶çš„é”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚æ­¤é’©å­ä¼šæ”¶åˆ°ä¸‰ä¸ªå‚æ•°ï¼šé”™è¯¯å¯¹è±¡ã€å‘ç”Ÿé”™è¯¯çš„ç»„ä»¶å®ä¾‹ä»¥åŠä¸€ä¸ªåŒ…å«é”™è¯¯æ¥æºä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚æ­¤é’©å­å¯ä»¥è¿”å› `false` ä»¥é˜»æ­¢è¯¥é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­ã€‚ä½ å¯ä»¥åœ¨æ­¤é’©å­ä¸­ä¿®æ”¹ç»„ä»¶çš„çŠ¶æ€ã€‚å› æ­¤åœ¨æ•è·é”™è¯¯æ—¶ï¼Œåœ¨æ¨¡æ¿æˆ–æ¸²æŸ“å‡½æ•°ä¸­æœ‰ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­æ¥ç»•è¿‡å…¶å®ƒå†…å®¹å°±å¾ˆé‡è¦ï¼›ä¸ç„¶è¯¥ç»„ä»¶å¯èƒ½ä¼šè¿›å…¥ä¸€ä¸ªæ— é™çš„æ¸²æŸ“å¾ªç¯ã€‚

**é”™è¯¯ä¼ æ’­è§„åˆ™**

- é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå…¨å±€çš„ `config.errorHandler` è¢«å®šä¹‰ï¼Œæ‰€æœ‰çš„é”™è¯¯ä»ä¼šå‘é€å®ƒï¼Œå› æ­¤è¿™äº›é”™è¯¯ä»ç„¶ä¼šå‘å•ä¸€çš„åˆ†ææœåŠ¡çš„åœ°æ–¹è¿›è¡Œæ±‡æŠ¥ã€‚
- å¦‚æœä¸€ä¸ªç»„ä»¶çš„ç»§æ‰¿æˆ–çˆ¶çº§ä»å±é“¾è·¯ä¸­å­˜åœ¨å¤šä¸ª `errorCaptured` é’©å­ï¼Œåˆ™å®ƒä»¬å°†ä¼šè¢«ç›¸åŒçš„é”™è¯¯é€ä¸ªå”¤èµ·ã€‚
- å¦‚æœæ­¤ `errorCaptured` é’©å­è‡ªèº«æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œåˆ™è¿™ä¸ªæ–°é”™è¯¯å’ŒåŸæœ¬è¢«æ•è·çš„é”™è¯¯éƒ½ä¼šå‘é€ç»™å…¨å±€çš„ `config.errorHandler`ã€‚
- ä¸€ä¸ª `errorCaptured` é’©å­èƒ½å¤Ÿè¿”å› `false` ä»¥é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­ã€‚æœ¬è´¨ä¸Šæ˜¯è¯´â€œè¿™ä¸ªé”™è¯¯å·²ç»è¢«æå®šäº†ä¸”åº”è¯¥è¢«å¿½ç•¥â€ã€‚å®ƒä¼šé˜»æ­¢å…¶å®ƒä»»ä½•ä¼šè¢«è¿™ä¸ªé”™è¯¯å”¤èµ·çš„ `errorCaptured` é’©å­å’Œå…¨å±€çš„ `config.errorHandler`ã€‚

åœ¨ Vue.js ä¸­ï¼Œ`errorCaptured` æ˜¯ä¸€ä¸ªç»„ä»¶é€‰é¡¹ï¼Œç”¨äºæ•è·å’Œå¤„ç†å­ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚å®ƒæ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œå¯ä»¥åœ¨ç»„ä»¶å±‚çº§é—´ä¼ æ’­å’Œå¤„ç†é”™è¯¯ã€‚

ä½¿ç”¨ `errorCaptured` é€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­æ•è·å¹¶å¤„ç†å­ç»„ä»¶ä¸­æŠ›å‡ºçš„é”™è¯¯ï¼Œè€Œä¸ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒã€‚ä¸€æ—¦å­ç»„ä»¶ä¸­å‘ç”Ÿé”™è¯¯ï¼Œçˆ¶ç»„ä»¶å°†ä¼šè§¦å‘ `errorCaptured` é’©å­å‡½æ•°ï¼Œå¹¶æ¥æ”¶åˆ°é”™è¯¯å¯¹è±¡å’Œç»„ä»¶å®ä¾‹ä½œä¸ºå‚æ•°ã€‚

`errorCaptured` çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š

1. é”™è¯¯è¾¹ç•Œï¼ˆError Boundaryï¼‰ï¼šé€šè¿‡åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ `errorCaptured` é’©å­å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨å­ç»„ä»¶ä¸­æ•è·å’Œå¤„ç†é”™è¯¯ï¼Œä»è€Œé˜²æ­¢é”™è¯¯æ³¢åŠåˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚
2. é”™è¯¯æ—¥å¿—è®°å½•ï¼šä½ å¯ä»¥åœ¨ `errorCaptured` é’©å­å‡½æ•°ä¸­å°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°åç«¯æ—¥å¿—æœåŠ¡æˆ–é”™è¯¯ç›‘æ§å·¥å…·ï¼Œä»¥ä¾¿è¿›è¡Œé”™è¯¯åˆ†æå’Œä¿®å¤ã€‚

åœ¨ Vue.js ä¸­ï¼Œè¿˜æœ‰å…¶ä»–ä¸ `errorCaptured` ç›¸å…³çš„é€‰é¡¹å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

- `errorHandler` é€‰é¡¹ï¼šç”¨äºå…¨å±€å¤„ç†æœªè¢«ç»„ä»¶æ•è·çš„é”™è¯¯ã€‚
- `vm.$emit('hook:error', err)` æ–¹æ³•ï¼šç”¨äºæ‰‹åŠ¨è§¦å‘ç»„ä»¶é”™è¯¯ï¼Œå¹¶å°†é”™è¯¯ä¼ é€’ç»™ `errorCaptured` æˆ– `errorHandler` è¿›è¡Œå¤„ç†ã€‚

è¿™äº›é€‰é¡¹å’Œæ–¹æ³•æä¾›äº†çµæ´»çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä½¿ä½ èƒ½å¤Ÿåœ¨ Vue.js åº”ç”¨ç¨‹åºä¸­æ›´å¥½åœ°ç®¡ç†å’Œå¤„ç†é”™è¯¯ã€‚

`errorCaptured` æ˜¯ Vue 2 ä¸­çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œç”¨äºæ•è·å­ç»„ä»¶ä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚å®ƒå¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ï¼Œå¹¶åœ¨å­ç»„ä»¶å‘ç”Ÿé”™è¯¯æ—¶è¿›è¡Œå¤„ç†ã€‚

å½“å­ç»„ä»¶ä¸­çš„é”™è¯¯æœªè¢«æ•è·æ—¶ï¼Œé”™è¯¯ä¼šå‘ä¸Šå†’æ³¡åˆ°çˆ¶ç»„ä»¶ã€‚æ­¤æ—¶ï¼Œå¦‚æœçˆ¶ç»„ä»¶å®šä¹‰äº† `errorCaptured` é’©å­å‡½æ•°ï¼ŒVue ä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œä¼ å…¥é”™è¯¯å¯¹è±¡å’ŒåŒ…å«é”™è¯¯æ¥æºä¿¡æ¯çš„ç»„ä»¶å®ä¾‹ã€‚

ä½¿ç”¨ `errorCaptured` é’©å­å‡½æ•°ï¼Œå¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­å¯¹å­ç»„ä»¶çš„é”™è¯¯è¿›è¡Œå¤„ç†ã€è®°å½•æˆ–æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œåœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ `errorCaptured` é’©å­å‡½æ•°æ¥æ•è·å¹¶å¤„ç†å­ç»„ä»¶ä¸­çš„é”™è¯¯ï¼š

```javascript
<template>
  <div>
    <child-component></child-component>
  </div>
</template>

<script>
export default {
  components: {
    ChildComponent
  },
  errorCaptured(err, vm, info) {
    console.error('æ•è·åˆ°å­ç»„ä»¶é”™è¯¯ï¼š', err);
    console.error('é”™è¯¯æ¥æºï¼š', info);
    // è¿›è¡Œé”™è¯¯å¤„ç†
  }
};
</script>
```

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œçˆ¶ç»„ä»¶ä¸­å®šä¹‰äº† `errorCaptured` é’©å­å‡½æ•°æ¥æ•è·å­ç»„ä»¶æŠ›å‡ºçš„é”™è¯¯ã€‚å½“å­ç»„ä»¶å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå°†ä¼šè§¦å‘è¯¥é’©å­å‡½æ•°ï¼Œå¹¶ä¼ å…¥é”™è¯¯å¯¹è±¡ `err`ã€ç»„ä»¶å®ä¾‹ `vm` å’Œé”™è¯¯æ¥æºä¿¡æ¯ `info`ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥è¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†ï¼Œä¾‹å¦‚æ‰“å°é”™è¯¯ä¿¡æ¯ã€å‘é€é”™è¯¯æŠ¥å‘Šç­‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`errorCaptured` é’©å­å‡½æ•°åªèƒ½æ•è·å­å­™ç»„ä»¶æŠ›å‡ºçš„é”™è¯¯ï¼Œæ— æ³•æ•è·æ ¹ç»„ä»¶ä¸­çš„é”™è¯¯ã€‚å¦å¤–ï¼Œå¦‚æœçˆ¶ç»„ä»¶å’Œå­ç»„ä»¶éƒ½å®šä¹‰äº† `errorCaptured` é’©å­å‡½æ•°ï¼Œåªæœ‰æœ€è¿‘çš„ç¥–å…ˆç»„ä»¶çš„é’©å­å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚

æ€»ä¹‹ï¼Œ`errorCaptured` æ˜¯ Vue 2 ä¸­çš„ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼Œç”¨äºæ•è·å¹¶å¤„ç†å­ç»„ä»¶ä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚é€šè¿‡ä½¿ç”¨å®ƒï¼Œå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„å®¹é”™æ€§å’Œé”™è¯¯å¤„ç†èƒ½åŠ›ã€‚

## å¼€å‘è€…æ¨¡å¼

### `renderTracked `

åœ¨ä¸€ä¸ªå“åº”å¼ä¾èµ–è¢«ç»„ä»¶çš„æ¸²æŸ“ä½œç”¨è¿½è¸ªåè°ƒç”¨ã€‚

**è¿™ä¸ªé’©å­ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨ï¼Œä¸”åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸ä¼šè¢«è°ƒç”¨ã€‚**

åœ¨ Vue.js ä¸­ï¼Œ`renderTracked` æ˜¯ä¸€ä¸ªå¼€å‘è€…å·¥å…·é’©å­å‡½æ•°ï¼Œç”¨äºè·Ÿè¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­çš„ä¾èµ–è·Ÿè¸ªæƒ…å†µã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°äº†è§£ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­çš„å“åº”å¼æ•°æ®ä¾èµ–å…³ç³»ã€‚

å½“ Vue.js æ¸²æŸ“å™¨è·Ÿè¸ªå“åº”å¼æ•°æ®æ—¶ï¼Œæ¯å½“æŸä¸ªæ•°æ®è¢«ç”¨äºè®¡ç®—å±æ€§ã€æ¨¡æ¿æˆ–ä¾¦å¬å™¨ä¸­æ—¶ï¼Œè·Ÿè¸ªç³»ç»Ÿéƒ½ä¼šè®°å½•ä¸‹è¿™äº›ä¾èµ–é¡¹å’Œå®ƒä»¬çš„å…³ç³»ã€‚`renderTracked` é’©å­å‡½æ•°èƒ½å¤Ÿæ•è·å¹¶æ‰“å°å‡ºè¿™äº›ä¾èµ–é¡¹çš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®å¯¹è±¡ã€ä¾èµ–é¡¹çš„é”®å€¼å’Œä¾èµ–é¡¹æ‰€å±çš„ç»„ä»¶å®ä¾‹ã€‚

ç±»å‹ï¼š

```javascript
interface ComponentOptions {
  renderTracked?(this: ComponentPublicInstance, e: DebuggerEvent): void
}

type DebuggerEvent = {
  effect: ReactiveEffect
  target: object
  type: TrackOpTypes /* 'get' | 'has' | 'iterate' */
  key: any
}
```

`renderTracked` çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š

1. æ€§èƒ½ä¼˜åŒ–ï¼šé€šè¿‡è§‚å¯Ÿæ¸²æŸ“è¿‡ç¨‹ä¸­çš„ä¾èµ–é¡¹ï¼Œä½ å¯ä»¥ç¡®å®šå“ªäº›æ•°æ®æˆ–è®¡ç®—å±æ€§å¯¹äºæ¸²æŸ“ç»“æœå…·æœ‰é‡è¦æ€§ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„ä¼˜åŒ–ï¼Œå‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œæ›´æ–°ã€‚
2. è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼šå½“ä½ é‡åˆ°æ¸²æŸ“ç›¸å…³çš„é—®é¢˜ï¼Œå¦‚ç»„ä»¶é¢‘ç¹æ›´æ–°æˆ–é”™è¯¯çš„ä¾èµ–è·Ÿè¸ªï¼Œå¯ä»¥ä½¿ç”¨ `renderTracked` æ¥æŸ¥çœ‹å“ªäº›ä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–æˆ–è¢«é¢‘ç¹è®¿é—®ã€‚

```javascript
import { onRenderTracked } from 'vue';

onRenderTracked((target, key) => {
  console.log(`Dependancy "${key}" in component has been tracked.`);
});

```

åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ`onRenderTracked` å‡½æ•°ç”¨äºæ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šåœ¨ç»„ä»¶çš„æ¸²æŸ“æœŸé—´ï¼ŒæŸä¸ªå“åº”å¼ä¾èµ–è¢«è¿½è¸ªæ—¶è¢«è°ƒç”¨ã€‚åœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œä½ å¯ä»¥è·å–åˆ°è¢«è¿½è¸ªçš„ä¾èµ–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¾èµ–æ‰€åœ¨çš„ç›®æ ‡å¯¹è±¡ï¼ˆtargetï¼‰ä»¥åŠä¾èµ–çš„é”®å€¼ï¼ˆkeyï¼‰ã€‚

### `renderTriggered`

åœ¨ä¸€ä¸ªå“åº”å¼ä¾èµ–è¢«ç»„ä»¶è§¦å‘äº†é‡æ–°æ¸²æŸ“ä¹‹åè°ƒç”¨ã€‚

**è¿™ä¸ªé’©å­ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨ï¼Œä¸”åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸ä¼šè¢«è°ƒç”¨ã€‚**

- `renderTriggered`ï¼šç”¨äºåœ¨ä¾èµ–é¡¹è¢«è§¦å‘é‡æ–°è®¡ç®—æ—¶è§¦å‘ï¼Œæä¾›ç±»ä¼¼çš„åŠŸèƒ½å’Œç”¨é€”ã€‚

ç±»å‹ï¼š

```javascript
interface ComponentOptions {
  renderTriggered?(this: ComponentPublicInstance, e: DebuggerEvent): void
}

type DebuggerEvent = {
  effect: ReactiveEffect
  target: object
  type: TriggerOpTypes /* 'set' | 'add' | 'delete' | 'clear' */
  key: any
  newValue?: any
  oldValue?: any
  oldTarget?: Map<any, any> | Set<any>
}
```

## æœåŠ¡ç«¯æ¸²æŸ“

### `serverPrefetch `

å½“ç»„ä»¶å®ä¾‹åœ¨æœåŠ¡å™¨ä¸Šè¢«æ¸²æŸ“ä¹‹å‰è¦å®Œæˆçš„å¼‚æ­¥å‡½æ•°ã€‚

- **ç±»å‹**
  ```typescript
  interface ComponentOptions {
    serverPrefetch?(this: ComponentPublicInstance): Promise<any>
  }

  ```
- **è¯¦ç»†ä¿¡æ¯**

  å¦‚æœè¿™ä¸ªé’©å­è¿”å›äº†ä¸€ä¸ª Promiseï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ä¼šåœ¨æ¸²æŸ“è¯¥ç»„ä»¶å‰ç­‰å¾…è¯¥ Promise å®Œæˆã€‚

  è¿™ä¸ªé’©å­ä»…ä¼šåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­æ‰§è¡Œï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œä¸€äº›ä»…åœ¨æœåŠ¡ç«¯æ‰æœ‰çš„æ•°æ®æŠ“å–è¿‡ç¨‹ã€‚
- **ç¤ºä¾‹**
  ```javascript
  export default {
    data() {
      return {
        data: null
      }
    },
    async serverPrefetch() {
      // ç»„ä»¶ä¼šä½œä¸ºåˆæ¬¡è¯·æ±‚çš„ä¸€éƒ¨åˆ†è¢«æ¸²æŸ“
      // ä¼šåœ¨æœåŠ¡ç«¯é¢„æŠ“å–æ•°æ®ï¼Œå› ä¸ºè¿™æ¯”å®¢æˆ·ç«¯æ›´å¿«
      this.data = await fetchOnServer(/* ... */)
    },
    async mounted() {
      if (!this.data) {
        // å¦‚æœæ•°æ®åœ¨æŒ‚è½½æ—¶æ˜¯ nullï¼Œè¿™æ„å‘³ç€è¿™ä¸ªç»„ä»¶
        // æ˜¯åœ¨å®¢æˆ·ç«¯åŠ¨æ€æ¸²æŸ“çš„ï¼Œè¯·å¦å¤–æ‰§è¡Œä¸€ä¸ª
        // å®¢æˆ·ç«¯è¯·æ±‚ä½œä¸ºæ›¿ä»£
        this.data = await fetchOnClient(/* ... */)
      }
    }
  }
  ```
- **å‚è€ƒ**[æœåŠ¡ç«¯æ¸²æŸ“](https://cn.vuejs.org/guide/scaling-up/ssr.html "æœåŠ¡ç«¯æ¸²æŸ“")

## çˆ¶å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­æ‰§è¡Œé¡ºåº

Vue çš„çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ‰§è¡Œé¡ºåºå¯ä»¥å½’ç±»ä¸ºä»¥ä¸‹ 4 éƒ¨åˆ†ï¼š

- åŠ è½½æ¸²æŸ“è¿‡ç¨‹

  çˆ¶ beforeCreate -> çˆ¶ created -> çˆ¶ beforeMount -> å­ beforeCreate -> å­ created -> å­ beforeMount -> å­ mounted -> çˆ¶ mounted
- å­ç»„ä»¶æ›´æ–°è¿‡ç¨‹

  çˆ¶ beforeUpdate -> å­ beforeUpdate -> å­ updated -> çˆ¶ updated
- çˆ¶ç»„ä»¶æ›´æ–°è¿‡ç¨‹

  çˆ¶ beforeUpdate -> çˆ¶ updated
- é”€æ¯è¿‡ç¨‹

  çˆ¶ beforeDestroy -> å­ beforeDestroy -> å­ destroyed -> çˆ¶ destroyed

## çˆ¶ç»„ä»¶èƒ½ç›‘å¬åˆ°å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå—

åœ¨Vue.jsä¸­ï¼Œçˆ¶ç»„ä»¶ä¸èƒ½ç›´æ¥ç›‘å¬å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä½†å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§é—´æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶æ€»çº¿ã€`$emit` äº‹ä»¶æˆ–ç›´æ¥è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•æ¥é€šçŸ¥çˆ¶ç»„ä»¶å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸è§çš„å®ç°æ–¹æ³•ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶ï¼ˆ`$emit`ï¼‰

å­ç»„ä»¶åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ä½¿ç”¨ `$emit` å‘é€è‡ªå®šä¹‰äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ç›‘å¬è¿™äº›äº‹ä»¶æ¥é—´æ¥è·çŸ¥å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ã€‚

**å­ç»„ä»¶ï¼ˆChildComponent.vueï¼‰**

```vue
<template>
  <div>
    Child Component
  </div>
</template>

<script>
export default {
  name: 'ChildComponent',
  created() {
    this.$emit('child-created');
  },
  mounted() {
    this.$emit('child-mounted');
  },
  destroyed() {
    this.$emit('child-destroyed');
  }
};
</script>
```

**çˆ¶ç»„ä»¶ï¼ˆParentComponent.vueï¼‰**

```vue
<template>
  <div>
    Parent Component
    <ChildComponent @child-created="onChildCreated" @child-mounted="onChildMounted" @child-destroyed="onChildDestroyed"/>
  </div>
</template>

<script>
import ChildComponent from './ChildComponent.vue';

export default {
  name: 'ParentComponent',
  components: {
    ChildComponent
  },
  methods: {
    onChildCreated() {
      console.log('Child component created');
    },
    onChildMounted() {
      console.log('Child component mounted');
    },
    onChildDestroyed() {
      console.log('Child component destroyed');
    }
  }
};
</script>
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨äº‹ä»¶æ€»çº¿ï¼ˆEvent Busï¼‰

ä½¿ç”¨äº‹ä»¶æ€»çº¿æ¥åœ¨å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å‘é€äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶é€šè¿‡äº‹ä»¶æ€»çº¿ç›‘å¬è¿™äº›äº‹ä»¶ã€‚

**äº‹ä»¶æ€»çº¿ï¼ˆeventBus.jsï¼‰**

```javascript
import Vue from 'vue';
export const EventBus = new Vue();
```

**å­ç»„ä»¶ï¼ˆChildComponent.vueï¼‰**

```vue
<template>
  <div>
    Child Component
  </div>
</template>

<script>
import { EventBus } from './eventBus';

export default {
  name: 'ChildComponent',
  created() {
    EventBus.$emit('child-created');
  },
  mounted() {
    EventBus.$emit('child-mounted');
  },
  destroyed() {
    EventBus.$emit('child-destroyed');
  }
};
</script>
```

**çˆ¶ç»„ä»¶ï¼ˆParentComponent.vueï¼‰**

```vue
<template>
  <div>
    Parent Component
    <ChildComponent/>
  </div>
</template>

<script>
import ChildComponent from './ChildComponent.vue';
import { EventBus } from './eventBus';

export default {
  name: 'ParentComponent',
  components: {
    ChildComponent
  },
  created() {
    EventBus.$on('child-created', this.onChildCreated);
    EventBus.$on('child-mounted', this.onChildMounted);
    EventBus.$on('child-destroyed', this.onChildDestroyed);
  },
  beforeDestroy() {
    EventBus.$off('child-created', this.onChildCreated);
    EventBus.$off('child-mounted', this.onChildMounted);
    EventBus.$off('child-destroyed', this.onChildDestroyed);
  },
  methods: {
    onChildCreated() {
      console.log('Child component created');
    },
    onChildMounted() {
      console.log('Child component mounted');
    },
    onChildDestroyed() {
      console.log('Child component destroyed');
    }
  }
};
</script>
```

### æ–¹æ³•ä¸‰ï¼šè°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•

åœ¨å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ï¼Œç›´æ¥è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•æ¥é€šçŸ¥çˆ¶ç»„ä»¶ã€‚

**å­ç»„ä»¶ï¼ˆChildComponent.vueï¼‰**

```vue
<template>
  <div>
    Child Component
  </div>
</template>

<script>
export default {
  name: 'ChildComponent',
  created() {
    this.$parent.onChildCreated();
  },
  mounted() {
    this.$parent.onChildMounted();
  },
  destroyed() {
    this.$parent.onChildDestroyed();
  }
};
</script>
```

**çˆ¶ç»„ä»¶ï¼ˆParentComponent.vueï¼‰**

```vue
<template>
  <div>
    Parent Component
    <ChildComponent/>
  </div>
</template>

<script>
import ChildComponent from './ChildComponent.vue';

export default {
  name: 'ParentComponent',
  components: {
    ChildComponent
  },
  methods: {
    onChildCreated() {
      console.log('Child component created');
    },
    onChildMounted() {
      console.log('Child component mounted');
    },
    onChildDestroyed() {
      console.log('Child component destroyed');
    }
  }
};
</script>
```

> ğŸ“Œè™½ç„¶Vue.jsæ²¡æœ‰ç›´æ¥æä¾›çˆ¶ç»„ä»¶ç›‘å¬å­ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­çš„APIï¼Œä½†å¯ä»¥é€šè¿‡è‡ªå®šä¹‰äº‹ä»¶ã€äº‹ä»¶æ€»çº¿æˆ–è€…ç›´æ¥è°ƒç”¨çˆ¶ç»„ä»¶çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚è¿™äº›æ–¹æ³•éƒ½èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¸®åŠ©çˆ¶ç»„ä»¶äº†è§£å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼Œæ ¹æ®å…·ä½“çš„éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ–¹æ³•è¿›è¡Œå®ç°ã€‚
