# data

<!-- ## 目录

- [类型介绍](#类型介绍)
- [关键原理](#关键原理)
- [编译过程](#编译过程) -->

> 📌`Vue.js `中的 `data`（Obj/Function）属性是 `Vue `实例的一个配置选项。

## **类型**介绍

- **对象式**

  对于根实例或者非复用组件，通常直接提供一个对象字面量作为 `data` 的值。

  在对象式中，`data`属性是一个普通的对象，并且直接作为组件实例的一个属性。
  ```javascript
  // 对象形式 (适用于根实例或非复用组件)
  new Vue({
    data: {
      message: 'Hello, Vue!',
      count: 0,
      user: {
        name: 'John Doe',
        age: 30
      }
    },
    // 其他选项...
  })

  ```
  - 区别：`data` 是一个普通的对象，通过对象属性初始化数据。
  - 优点：
    - 语法简洁，直观易懂。可以通过对象字面量的方式一次性定义多个属性，方便管理多个数据。
  - 缺点：
    - 数据共享风险：所有组件实例共享同一个数据对象，如果 `data` **仍然是一个纯粹的对象，当多个组件修改同一个属性时，则所有的实例将共享引用同一个数据对象！可能会造成意外的数据污染，不方便追踪数据的变化来源。**
- 在**函数式**中，`data`属性是一个返回一个对象的函数。

  对于复用型组件（如.vue文件），推荐使用函数形式来返回一个**新对象实例**
  ```javascript
  // 函数形式 (适用于复用组件)
  Vue.component('my-component', {
    data() {
      return {
        localMessage: 'Hello from Component!'
  //此处的this是Vue实例对象，data函数不能写成箭头函数，不然this会指向window
      };
      }
    },
    // 其他选项...
  })

  ```
  - 区别：`data` 是一个返回包含数据对象的函数。
  - 优点：
    - 数据独立性：**每个组件实例都有独立的数据对象，避免了数据共享风险。**
    - 可以在函数中进行复杂的数据处理或计算，对数据进行响应式处理。
  - 缺点：
    - 代码略显繁琐，**需要使用 ****`return`**** 关键字返回数据对象。**
    - 不如对象式写法直观，特别是当需要定义多个属性时，需要书写更多的代码。
- **限制：** 组件的定义只接受 `function`。
- **访问与更新**：

  在模板中，可以通过 `Mustache `语法 (`{{ }}`) 来显示 `data` 中的数据。同时，`Vue `提供了响应式系统，任何通过`Vue`实例方法或计算属性对 `data` 的更改都会触发相应的视图更新。
- **注意事项**：
  - 由`Vue`管理的函数，一定不要写箭头函数，一旦写了箭头函数，`this`就不再是`Vue`实例了。用来定义要在当前`vue`实例中使用的数据

## 关键原理

1. `Vue `实例的数据对象。\*\*`Vue `****将会递归将****`  data  `****的 ****`property`**** 转换为 ****`getter`****/****`setter`，从而让 ​`data `的 ​`property`能够响应数据变化。浏览器 ​`API `创建的原生对象，原型上的 ​`property`会被忽略。\*\*对于数组也有特殊的变更检测机制。
2. 实例创建之后，可以通过 `vm.$data` 访问原始数据对象。`Vue `实例代理了 `data `对象上的所有属性，因此通过 `vm.a` 访问等同于 `vm.$data.a`
3. 以 `_` 或 `$` 开头的 **`property`不会**被 `Vue `实例代理，因为它们可能和 `Vue `内置的 **`property`**、`API `方法冲突。你可以使用例如 `vm.$data._property` 的方式访问这些 **`property`**。
4. 通过提供 \*\*`data `\*\*函数，每次创建一个新实例后，能够调用 `data `函数，以便返回一个全新副本的初始数据对象。如果需要，可以通过将 `vm.$data` 传入 `JSON.parse(JSON.stringify(...))` 来获得原始数据对象的深拷贝。

## 编译过程

> 📌Vue.js 中的 `data` 是 `Vue `实例的核心配置选项之一，它用于定义组件或实例的状态（数据）。在`Vue`中，数据与视图是双向绑定的，这意味着当 `data` 中的数据发生变化时，依赖这些数据的`DOM`元素会自动更新；反之，用户对视图中的表单元素进行交互，也会相应地更新 `data` 中的数据。

以下是`Vue`中`data`中的数据最后能够显示出来的中间过程：

1. **初始化阶段**：
   - `Vue`实例创建时，会遍历`data`对象的所有属性，并使用`Object.defineProperty()`方法将它们转换为\*\*`getter`**和**`setter`\*\*。
   - 对每个属性创建 \*\*`getter`\*\*和 \*\*`setter`**函数，**`getter`\*\*用于获取数据值，`setter `在数据变化时触发相关依赖的更新。
   - 这样做的目的是使每个属性**具有响应式能力**，即每当属性值发生改变时，`Vue`可以检测到变化并触发相应的视图更新。
2. **模板编译阶段**：
   - 当模板编译过程中遇到绑定到响应式数据的表达式时，\*\*`Vue `会创建一个****`Watcher`****（观察者）实例，并调用`getter`\*\***访问该数据。**
   - 在访问过程中，\*\*`getter`\*\*会将当前的 `Watcher `添加到对应的 `Dep`（依赖收集器）的订阅者列表中，从而建立起“数据 -> 观察者”的关联关系。
   - `Vue`会解析模板（`template`）中的指令、插值表达式等，并生成对应的访问器函数与渲染函数。
   - 当模板中包含如`{{ dataItem }}`这样的插值表达式时，`Vue`会在内部将其转换为对响应式数据的读取操作。
3. **挂载阶段**：
   - `Vue`实例通过`el`选项挂载到指定的`DOM`元素上后，会调用渲染函数生成初始的虚拟`DOM`树。
   - 根据`data`中的初始值，虚拟`DOM`树会反映当前的数据状态。
4. **数据变化与视图更新**：
   - 当`data`中的数据发生变化时（例如通过直接赋值或事件处理函数修改），由于响应式系统的作用，`Vue`能够捕捉到这一变化。
   - \*\*`setter`\*\*在执行时不仅会更新数据的实际值，还会通知与之相关的 `Dep `发布消息给所有订阅它的 `Watcher`。
   - 接收到变更通知的 `Watcher `会标记自己为待处理状态，并在其回调函数中重新计算表达式的值，进而触发相应的 `DOM `更新操作。
   - **`Vue `****虚拟****`DOM`****系统会比较新旧虚拟节点差异，然后最小化地更新实际****`DOM`，确保视图反映最新的数据状态。**

总结起来，`Vue`中的`data`数据能最终显示出来，是经过了初始化响应式数据、编译模板、根据初始数据生成虚拟`DOM`以及在数据变化时驱动视图更新等一系列过程。这样就实现了数据驱动视图（`Data Driven View`）的核心理念，使得开发者无需手动操作`DOM`就能实现动态界面的效果。
