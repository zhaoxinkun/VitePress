# el&#x20;

<!-- ## ç›®å½•

- [el ](#el-)
  - [ç›®å½•](#ç›®å½•)
  - [ç¤ºä¾‹](#ç¤ºä¾‹)
  - [åŸç†](#åŸç†)
    - [åˆå§‹åŒ– Vue å®ä¾‹](#åˆå§‹åŒ–-vue-å®ä¾‹)
    - [æŒ‚è½½ Vue å®ä¾‹](#æŒ‚è½½-vue-å®ä¾‹)
    - [æŸ¥è¯¢ DOM å…ƒç´ ](#æŸ¥è¯¢-dom-å…ƒç´ )
    - [æŒ‚è½½ç»„ä»¶](#æŒ‚è½½ç»„ä»¶)
    - [æ¸²æŸ“å’Œæ›´æ–°](#æ¸²æŸ“å’Œæ›´æ–°)
      - [ç”Ÿæˆè™šæ‹Ÿ DOM](#ç”Ÿæˆè™šæ‹Ÿ-dom)
      - [æ›´æ–° DOM](#æ›´æ–°-dom)
    - [è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™… DOM](#è™šæ‹Ÿ-dom-è½¬æ¢ä¸ºå®é™…-dom)
    - [æŒ‚è½½è¿‡ç¨‹æ€»ç»“](#æŒ‚è½½è¿‡ç¨‹æ€»ç»“) -->

> ğŸ“Œ`Vue.js` ä¸­çš„ `el`ï¼ˆ`Element`ï¼‰å±æ€§æ˜¯ `Vue `å®ä¾‹çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ã€‚å®ƒç”¨äºæŒ‡å®š `Vue `åº”ç”¨ç¨‹åºæŒ‚è½½åˆ°å“ªä¸ª`DOM`å…ƒç´ ä¸Šã€‚å½“ä¸€ä¸ª`Vue`å®ä¾‹è¢«åˆ›å»ºæ—¶ï¼Œ`el` å±æ€§å‘Šè¯‰`Vue`åº”è¯¥å°†ç”Ÿæˆçš„è§†å›¾ï¼ˆå³ç”±æ¨¡æ¿æˆ–`render`å‡½æ•°æ¸²æŸ“å‡ºçš„`DOM`å†…å®¹ï¼‰é™„åŠ åˆ°å“ªä¸ªå®é™…å­˜åœ¨çš„`HTML`å…ƒç´ å†…ã€‚å¼ºçƒˆå»ºè®®ä¸è¦æŒ‚è½½`body`

## ç¤ºä¾‹

- åœ¨å…¨å±€ `Vue `å®ä¾‹ï¼ˆå¦‚é€šå¸¸åœ¨åº”ç”¨å…¥å£æ–‡ä»¶ä¸­å®šä¹‰çš„åº”ç”¨æ ¹ç»„ä»¶ï¼‰ä¸­ï¼Œ`el` å¯ä»¥æ˜¯ä¸€ä¸ª `CSS `é€‰æ‹©å™¨å­—ç¬¦ä¸²æˆ–è€…ç›´æ¥æ˜¯ä¸€ä¸ª `HTMLElement `å¯¹è±¡ã€‚**åœ¨å®ä¾‹æŒ‚è½½ä¹‹åï¼Œå…ƒç´ å¯ä»¥ç”¨ **`vm.$el`** è®¿é—®ã€‚**
- åœ¨ç»„ä»¶å®šä¹‰ä¸­ï¼Œç”±äºç»„ä»¶é€šå¸¸æ˜¯ä½œä¸ºæ•´ä½“åµŒå…¥åˆ°å…¶ä»–ç»„ä»¶ä¸­çš„ï¼Œæ‰€ä»¥ç»„ä»¶çš„ `el` é€‰é¡¹åªèƒ½æ˜¯ä¸€ä¸ªè¿”å› `HTMLElement `çš„å‡½æ•°ï¼Œå¹¶ä¸”ä»…åœ¨ `Vue 2.x `ç‰ˆæœ¬çš„è‡ªå®šä¹‰å…ƒç´ å’ŒæŸäº›ç‰¹å®šé«˜çº§åœºæ™¯ä¸‹ä½¿ç”¨ï¼›**å¯¹äºå¸¸è§„çš„å•æ–‡ä»¶ç»„ä»¶ï¼ˆ.vue æ–‡ä»¶ï¼‰ï¼Œæ— éœ€ä¹Ÿå¹¶ä¸å…è®¸è®¾ç½® ****`el`**** å±æ€§ã€‚**
- **é™åˆ¶ï¼š** åªåœ¨ç”¨ `new` åˆ›å»ºå®ä¾‹æ—¶ç”Ÿæ•ˆã€‚

1. `new Vue`æ—¶å€™é…ç½®`el`å±æ€§ã€‚
   ```javascript
   // é¡µé¢ HTML éƒ¨åˆ†
   <div id="app">{{ message }}</div>

   // å…¨å±€ Vue å®ä¾‹
   new Vue({
     el: '#app', // è¿™é‡Œ 'app' æ˜¯é¡µé¢ä¸­æŸä¸ªå…ƒç´ çš„id //el:'#root'
     data: {
       message: 'Hello, world!'
     }
   })
   ```
   åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`Vue `å®ä¾‹é€šè¿‡ `el: '#app'` æŒ‡å®šäº†è¦æŒ‚è½½çš„ `DOM `å…ƒç´ ï¼Œå³å…·æœ‰ `id="app"` çš„ `<div>` å…ƒç´ ã€‚å½“åˆ›å»º `Vue `å®ä¾‹æ—¶ï¼Œ`Vue `å°†ä¼šåœ¨è¿™ä¸ªå…ƒç´ ä¸Šå»ºç«‹å®ä¾‹ä¸ `DOM `çš„å…³è”ï¼Œå¹¶å¼€å§‹è¿›è¡Œæ¨¡æ¿çš„ç¼–è¯‘å’ŒæŒ‚è½½æ“ä½œã€‚
2. **å…ˆåˆ›å»º**`Vue`**å®ä¾‹ï¼Œéšåå†é€šè¿‡**`vm.$mount('#root')`**æŒ‡å®š**`el`**çš„å€¼ã€‚**
   ```javascript
   const vm = new Vue({
   data:{
     name:'akun'
   }
   })
   console.log(vm)
   //ç¬¬äºŒç§å†™æ³•ï¼Œå¿…é¡»æœ‰å˜é‡æ¥æ”¶å®ä¾‹æ‰å¯ä»¥ç”¨ï¼Œæ›´çµæ´»ä¸€ç‚¹
   //å¯ä»¥ç”¨å®šæ—¶å™¨åŒ…è£¹ç­‰ã€‚ 
   vm.$mount('#root') 
   ```
   åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œ`Vue `é€šè¿‡è™šæ‹Ÿ `DOM `å’Œå“åº”å¼æ•°æ®ç³»ç»Ÿï¼Œå®ç°äº†é«˜æ•ˆçš„é¡µé¢æ¸²æŸ“ã€‚`Vue `ä¼šåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è®¡ç®—è™šæ‹Ÿ `DOM`ï¼Œç„¶åé€šè¿‡å·®å¼‚æ¯”å¯¹ç®—æ³•å°†å˜åŒ–çš„éƒ¨åˆ†æ›´æ–°åˆ°å®é™…çš„ `DOM `ä¸Šï¼Œä»è€Œå®ç°æ•°æ®é©±åŠ¨çš„è§†å›¾æ›´æ–°ã€‚

## åŸç†

> ğŸ“Œåœ¨`Vue.js`ä¸­ï¼Œ`el`å±æ€§ç”¨äºæŒ‡å®šä¸€ä¸ªå·²å­˜åœ¨çš„ `DOM `å…ƒç´ ï¼Œ`Vue `å°†ä¼šåœ¨è¿™ä¸ªå…ƒç´ ä¸ŠæŒ‚è½½å®ä¾‹ï¼Œä»è€Œå»ºç«‹èµ· `Vue `å®ä¾‹ä¸ `DOM `ä¹‹é—´çš„è”ç³»ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ `Vue.js` çš„æŒ‚è½½ï¼ˆ`mounting`ï¼‰é˜¶æ®µæ¥å®ç°çš„ã€‚

### åˆå§‹åŒ– Vue å®ä¾‹

å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Vue å®ä¾‹æ—¶ï¼Œä¼šæ‰§è¡Œ `_init` æ–¹æ³•ï¼š

```javascript
Vue.prototype._init = function (options) {
  const vm = this;
  vm.$options = mergeOptions(
    resolveConstructorOptions(vm.constructor),
    options || {}
  );
  // åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€æ¸²æŸ“ç­‰
  initLifecycle(vm);
  initEvents(vm);
  initRender(vm);
  
  // è°ƒç”¨ beforeCreate é’©å­
  callHook(vm, 'beforeCreate');
  
  // åˆå§‹åŒ–çŠ¶æ€
  initState(vm);
  
  // è°ƒç”¨ created é’©å­
  callHook(vm, 'created');
  
  // å¦‚æœæä¾›äº† el é€‰é¡¹ï¼Œåˆ™è°ƒç”¨ $mount æ–¹æ³•è¿›è¡ŒæŒ‚è½½
  if (vm.$options.el) {
    vm.$mount(vm.$options.el);
  }
};
```

### æŒ‚è½½ Vue å®ä¾‹

åœ¨ `_init` æ–¹æ³•ä¸­ï¼Œå¦‚æœæä¾›äº† `el` é€‰é¡¹ï¼Œä¼šè°ƒç”¨ `$mount` æ–¹æ³•ã€‚`$mount` æ–¹æ³•ä¼šæ ¹æ®ä¸åŒçš„æ¸²æŸ“æ¨¡å¼é€‰æ‹©åˆé€‚çš„æŒ‚è½½ç­–ç•¥ï¼š

```javascript
Vue.prototype.$mount = function (el) {
  el = el && query(el); // é€šè¿‡ query è·å– DOM å…ƒç´ 
  return mountComponent(this, el);
};
```

### æŸ¥è¯¢ DOM å…ƒç´ 

`query` å‡½æ•°ç”¨äºæŸ¥æ‰¾å¹¶è¿”å›å¯¹åº”çš„ DOM å…ƒç´ ï¼š

```javascript
function query(el) {
  if (typeof el === 'string') {
    const selected = document.querySelector(el);
    return selected;
  } else {
    return el;
  }
}
```

### æŒ‚è½½ç»„ä»¶

`mountComponent` æ–¹æ³•è´Ÿè´£æŒ‚è½½ç»„ä»¶ï¼š

```javascript
function mountComponent(vm, el) {
  vm.$el = el;
  
  // è°ƒç”¨ beforeMount é’©å­
  callHook(vm, 'beforeMount');
  
  let updateComponent;
  
  // æ¸²æŸ“å‡½æ•°
  updateComponent = () => {
    vm._update(vm._render());
  };
  
  // åˆ›å»ºæ¸²æŸ“ watcher
  new Watcher(vm, updateComponent, noop, {
    before() {
      if (vm._isMounted && !vm._isDestroyed) {
        callHook(vm, 'beforeUpdate');
      }
    }
  }, true);
  
  vm._isMounted = true;
  callHook(vm, 'mounted');
  return vm;
}
```

### æ¸²æŸ“å’Œæ›´æ–°

`mountComponent` ä¸­çš„ `updateComponent` å‡½æ•°ä¼šè°ƒç”¨ `_render` æ–¹æ³•ç”Ÿæˆè™šæ‹Ÿ DOMï¼Œå†è°ƒç”¨ `_update` æ–¹æ³•å°†è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™…çš„ DOM å¹¶åº”ç”¨åˆ°é¡µé¢ä¸Šã€‚

#### ç”Ÿæˆè™šæ‹Ÿ DOM

`_render` æ–¹æ³•ä¼šè°ƒç”¨ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼Œç”Ÿæˆè™šæ‹Ÿ DOMï¼š

```javascript
Vue.prototype._render = function () {
  const vm = this;
  const { render } = vm.$options;
  let vnode;
  vnode = render.call(vm._renderProxy, vm.$createElement);
  return vnode;
};
```

#### æ›´æ–° DOM

`_update` æ–¹æ³•ä¼šå°†è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™…çš„ DOM å¹¶åº”ç”¨åˆ°é¡µé¢ä¸Šï¼š

```javascript
Vue.prototype._update = function (vnode) {
  const vm = this;
  const prevEl = vm.$el;
  const prevVnode = vm._vnode;
  const prevActiveInstance = activeInstance;
  activeInstance = vm;
  vm._vnode = vnode;
  
  if (!prevVnode) {
    // åˆæ¬¡æ¸²æŸ“
    vm.$el = vm.__patch__(vm.$el, vnode);
  } else {
    // æ›´æ–°
    vm.$el = vm.__patch__(prevVnode, vnode);
  }
  activeInstance = prevActiveInstance;
  
  if (prevEl) {
    prevEl.__vue__ = null;
  }
  if (vm.$el) {
    vm.$el.__vue__ = vm;
  }
};
```

### è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™… DOM

`__patch__` æ–¹æ³•ç”¨äºå°†è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™… DOMã€‚å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼Œå®ƒä¼šåˆ›å»ºæ–°å…ƒç´ ï¼›å¯¹äºæ›´æ–°ï¼Œå®ƒä¼šæ¯”è¾ƒæ–°æ—§è™šæ‹Ÿ DOMï¼Œè¿›è¡Œå¿…è¦çš„ DOM æ“ä½œï¼š

```javascript
Vue.prototype.__patch__ = function (oldVnode, vnode) {
  if (!oldVnode) {
    createElm(vnode);
  } else {
    patchVnode(oldVnode, vnode);
  }
};
```

### æŒ‚è½½è¿‡ç¨‹æ€»ç»“

1. **åˆå§‹åŒ–**ï¼šé€šè¿‡ `_init` æ–¹æ³•åˆå§‹åŒ– Vue å®ä¾‹ï¼ŒåŒ…æ‹¬ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶å’ŒçŠ¶æ€çš„åˆå§‹
2. **æŸ¥è¯¢ DOM å…ƒç´ **ï¼šé€šè¿‡ `query` æ–¹æ³•æ‰¾åˆ°æŒ‚è½½çš„ DOM å…ƒç´ 
3. **æŒ‚è½½ç»„ä»¶**ï¼šè°ƒç”¨ `mountComponent` æ–¹æ³•ï¼Œå°†ç»„ä»¶æŒ‚è½½åˆ°æŒ‡å®šçš„ DOM å…ƒç´ ä¸Š
4. **æ¸²æŸ“å’Œæ›´æ–°**ï¼šè°ƒç”¨ `_render` æ–¹æ³•ç”Ÿæˆè™šæ‹Ÿ DOMï¼Œå†è°ƒç”¨ `_update` æ–¹æ³•å°†è™šæ‹Ÿ DOM è½¬æ¢ä¸ºå®é™…çš„ DOM å¹¶åº”ç”¨åˆ°é¡µé¢ä¸Š

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Vue å®ä¾‹åˆ›å»ºå’ŒæŒ‚è½½çš„ç¤ºä¾‹ï¼š

```html
<div id="app">{{ message }}</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
  // åˆ›å»º Vue å®ä¾‹
  const vm = new Vue({
    el: '#app',  // æŒ‚è½½ç‚¹
    data: {
      message: 'Hello, Vue!'
    },
    // æ¸²æŸ“å‡½æ•°
    render(h) {
      return h('div', this.message);
    }
  });
</script>
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ Vue å®ä¾‹çš„åˆ›å»ºå’ŒæŒ‚è½½è¿‡ç¨‹ï¼Œé€šè¿‡ `el` é€‰é¡¹å°† Vue å®ä¾‹æŒ‚è½½åˆ° `#app` å…ƒç´ ä¸Šï¼Œå¹¶é€šè¿‡æ¸²æŸ“å‡½æ•°å°† `message` æ¸²æŸ“åˆ° DOM ä¸­ã€‚
