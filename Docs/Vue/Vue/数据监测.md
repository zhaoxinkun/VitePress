# æ•°æ®ç›‘æµ‹

<!-- ## ç›®å½•

- [é—®é¢˜å¼•å…¥](#é—®é¢˜å¼•å…¥)
- [ç›‘æµ‹åŸç†](#ç›‘æµ‹åŸç†)
- [æ¨¡æ‹Ÿç›‘æµ‹](#æ¨¡æ‹Ÿç›‘æµ‹)
- [å¯¹äºå¯¹è±¡](#å¯¹äºå¯¹è±¡)
- [Vue.Set](#VueSet)
- [å¯¹äºæ•°ç»„](#å¯¹äºæ•°ç»„)
- [å“åº”å¼ property](#å“åº”å¼-property)
- [å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—](#å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—) -->

> ğŸ“Œvueä¼šç›‘è§†dataä¸­æ‰€æœ‰å±‚æ¬¡çš„æ•°æ®ã€‚

> ğŸ“Œ`Object.defineProperty`æ–¹æ³•ä¸ºæ¯ä¸€ä¸ªæ·»åŠ çš„å±æ€§éƒ½åˆ¶å®šäº†ä¸€ä¸ªgetter/setterï¼Œç›‘å¬å±æ€§çš„ getter å’Œ setter æ“ä½œï¼Œå½“æœ‰äººè¯»å–çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘getterï¼Œå½“æœ‰äººä¿®æ”¹çš„æ—¶å€™å°±ä¼šè§¦å‘setterï¼Œï¼ˆsetterçš„æµç¨‹ï¼šä½ å…ˆåœ¨æ§åˆ¶å°è¿›è¡Œä¿®æ”¹ï¼Œç„¶åsetterä¼šä¿®æ”¹æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œç„¶åæ¨¡å‹ä¸­çš„æ•°æ®ï¼Œåˆä¼šè¢«æ•°æ®ä»£ç†æ·»åŠ åˆ°vmæ¨¡å‹ä¸Šï¼Œä»è€Œå¯¼è‡´è§†å›¾çš„å˜åŒ–ï¼‰ä½ çš„dataè¢«æ•°æ®ä»£ç†ä¹‹åï¼Œå°±ä¼šåˆä¸‹åˆ’çº¿dataï¼Œå› ä¸ºå¯¹ä½ çš„dataè¿›è¡Œäº†å‡çº§ï¼Œè€Œè¿™ä¸€ç›‘æµ‹çš„è¿‡ç¨‹å°±æ˜¯æ•°æ®åŠ«æŒã€‚é€šè¿‡è¿™ç§åŠ«æŒï¼ŒVue èƒ½å¤Ÿè¿½è¸ªæ•°æ®çš„å˜åŒ–ï¼Œå®ç°äº†æ•°æ®çš„å“åº”å¼ã€‚å½“ä½ è®¿é—®æˆ–ä¿®æ”¹æ•°æ®æ—¶ï¼ŒVue èƒ½å¤Ÿæ•è·è¿™äº›æ“ä½œï¼Œå¹¶è§¦å‘ç›¸åº”çš„æ›´æ–°ï¼Œä»¥ä¿æŒè§†å›¾å’Œæ•°æ®çš„åŒæ­¥ã€‚

## é—®é¢˜å¼•å…¥

> ğŸ“Œè¯´æ˜ä¸€ä¸ªé—®é¢˜å“ˆï¼Œé¦–å…ˆå°±æ˜¯æˆ‘ä»¬åœ¨åˆ—è¡¨æ¸²æŸ“çš„æ—¶å€™æœ‰ä¸€ä¸ªæ’åºæ¡ˆä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬å½“æ—¶ä¸å¤ªç†è§£Vueæ•°æ®æ›´æ–°çš„åŸç†ï¼Œæ‰€ä»¥ï¼Œå½“æ—¶æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹dataä¸­ **ï¼Œæ•°ç»„å¯¹è±¡æ•°æ®ä¸­çš„å˜åŒ–ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä¿®æ”¹ä¸€æ•´ä¸ªæ•°ç»„ä¸­ç´¢å¼•ä¸ºé›¶çš„å¯¹è±¡æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ— æ³•æ›´æ–°çš„é—®é¢˜ã€‚**

> ğŸ“Œåœ¨æ—©æœŸç‰ˆæœ¬çš„Vueä¸­ï¼Œç”±äºVueä½¿ç”¨çš„æ˜¯Object.definePropertyæ–¹æ³•æ¥å®ç°æ•°æ®çš„å“åº”å¼ï¼Œå› æ­¤æ— æ³•ç›´æ¥ç›‘æµ‹åˆ°æ•°ç»„çš„å˜åŒ–ï¼Œå› ä¸ºä¸€äº›æ•°ç»„çš„å˜åŒ–æ–¹æ³•ï¼ˆä¾‹å¦‚pushã€popã€spliceç­‰ï¼‰å¹¶ä¸ä¼šè§¦å‘å±æ€§çš„setterã€‚åæ¥ï¼ŒVueæä¾›äº†å‡ ç§å¯ä»¥ç›‘æµ‹åˆ°æ•°ç»„å˜åŒ–çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸€èˆ¬éƒ½æ˜¯ç›´æ¥æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨Vueæä¾›çš„å˜å¼‚æ–¹æ³•ï¼ˆmutation methodsï¼‰ï¼Œä¾‹å¦‚pushã€popã€shiftã€unshiftã€spliceã€sortå’Œreverseã€‚å½“ä½ ä½¿ç”¨è¿™äº›æ–¹æ³•æ”¹å˜æ•°ç»„æ—¶ï¼ŒVueèƒ½å¤Ÿæ•æ‰åˆ°è¿™äº›å˜åŒ–ï¼Œå¹¶è§¦å‘è§†å›¾çš„æ›´æ–°ã€‚

> ğŸ“Œé™¤äº†å˜å¼‚æ–¹æ³•å¤–ï¼ŒVueè¿˜æä¾›äº†ä¸€äº›éå˜å¼‚æ–¹æ³•ï¼ˆnon-mutating methodsï¼‰ï¼Œä¾‹å¦‚concatã€sliceå’Œfilterç­‰ã€‚è¿™äº›æ–¹æ³•å¹¶ä¸ä¼šç›´æ¥æ”¹å˜åŸæ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå› æ­¤Vueæ— æ³•ç›‘æµ‹åˆ°è¿™äº›æ–¹æ³•çš„å˜åŒ–ã€‚å¦‚æœä½ ä½¿ç”¨è¿™äº›éå˜å¼‚æ–¹æ³•ä¿®æ”¹æ•°ç»„ï¼Œä½ éœ€è¦æ‰‹åŠ¨é€šçŸ¥Vueè¿›è¡Œè§†å›¾çš„æ›´æ–°ï¼Œæˆ–è€…ä½¿ç”¨Vueæä¾›çš„\$setæ–¹æ³•æ¥é€šçŸ¥Vueè¿›è¡Œå“åº”å¼åœ°æ›´æ–°ã€‚

```javascript
<!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨-->
    <div id="root">
      <h2>äººå‘˜åˆ—è¡¨</h2>
      <button @click="updateMei">æ›´æ–°é©¬å†¬æ¢…çš„ä¿¡æ¯</button>
      <ul>
        <li v-for="(p,index) of persons" :key="p.id">
          {{p.name}}-{{p.age}}-{{p.sex}}
        </li>
      </ul>
    </div>

    <script type="text/javascript">
      Vue.config.productionTip = false
      
      const vm = new Vue({
        el:'#root',
        data:{
          persons:[
            {id:'001',name:'é©¬å†¬æ¢…',age:30,sex:'å¥³'},
            {id:'002',name:'å‘¨å†¬é›¨',age:31,sex:'å¥³'},
            {id:'003',name:'å‘¨æ°ä¼¦',age:18,sex:'ç”·'},
            {id:'004',name:'æ¸©å…†ä¼¦',age:19,sex:'ç”·'}
          ]
        },
        methods: {
           updateMei(){
            // this.persons[0].name = 'é©¬è€å¸ˆ' //å¥æ•ˆ
            // this.persons[0].age = 50 //å¥æ•ˆ
            // this.persons[0].sex = 'ç”·' //å¥æ•ˆ
            // this.persons[0] = {id:'001',name:'é©¬è€å¸ˆ',age:50,sex:'ç”·'} //ä¸å¥æ•ˆ
            this.persons.splice(0,1,{id:'001',name:'é©¬è€å¸ˆ',age:50,sex:'ç”·'})
          } 
        }
      }) 

    </script>

```

ç„¶åå°±å¼•å‡ºï¼Œæˆ‘ä»¬å¯¹äºæ•°æ®ç›‘æµ‹çš„æ”¹å˜åŸç†ï¼ˆå¯¹è±¡ï¼‰

åŸå› å°±æ˜¯æˆ‘ä»¬çš„å¯¹è±¡ä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½è¢«Vueè¿›è¡Œäº†æ•°æ®ä»£ç†ï¼Œæœ‰è‡ªå·±çš„getå’Œsetï¼Œæ— è®ºä½ çš„å±‚æ¬¡æœ‰å¤šæ·±ï¼Œéƒ½æœ‰ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬æœ¬èº«ä»£ç ä¸­æ²¡æœ‰å†™çš„ï¼Œåç»­åœ¨æ§åˆ¶å°ä¸­æ·»åŠ æ˜¯ä¸ä¼šæœ‰çš„ï¼Œæ‰€æœ‰å°±æœ‰äº†Vue.setï¼ˆï¼‰APIï¼Œæ¥è¿›è¡Œæ·»åŠ ã€‚

> ğŸ“Œåœ¨ Vue çš„å“åº”å¼ç³»ç»Ÿä¸­ï¼Œ`Object.defineProperty` ç¡®å®å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œå¯¼è‡´åœ¨æ•°ç»„ä¸Šçš„æ•°æ®åŠ«æŒè¾ƒä¸ºå¤æ‚ï¼Œè€Œä¸”åœ¨æ•°ç»„é•¿åº¦å˜åŒ–ç­‰åœºæ™¯ä¸‹å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚Vue å¯¹æ­¤è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼Œæä¾›äº†ä¸€äº›èƒ½å¤Ÿè§¦å‘æ›´æ–°çš„æ•°ç»„å˜å¼‚æ–¹æ³•ï¼ˆmutation methodsï¼‰ï¼Œæ¯”å¦‚ `push`ã€`pop`ã€`shift`ã€`unshift`ã€`splice`ã€`sort` å’Œ `reverse`ã€‚è¿™äº›æ–¹æ³•è¢«ç§°ä¸ºæ•°ç»„çš„å˜å¼‚æ–¹æ³•ï¼Œå®ƒä»¬ä¼šè§¦å‘è§†å›¾æ›´æ–°ã€‚

```javascript
new Vue({
  data: {
    myArray: [1, 2, 3]
  },
  methods: {
    addItem() {
      // ä»¥ä¸‹çš„æ“ä½œä¼šè§¦å‘è§†å›¾æ›´æ–°
      this.myArray.push(4);
    }
  }
});
```

> ğŸ“Œå¯¹äºå¯¹è±¡ï¼ŒVue èƒ½å¤ŸåŠ«æŒå¯¹è±¡å±æ€§çš„ getter å’Œ setterï¼Œä»è€Œå®ç°å¯¹è±¡çš„å“åº”å¼ã€‚ä½†æ˜¯ï¼Œå½“ä½ ç›´æ¥é€šè¿‡ç´¢å¼•æˆ–ç›´æ¥è®¾ç½®æ•°ç»„é•¿åº¦æ—¶ï¼ŒVue æ˜¯æ— æ³•æ£€æµ‹åˆ°å˜åŒ–çš„ï¼Œå› æ­¤ä½ éœ€è¦ä½¿ç”¨æä¾›çš„å˜å¼‚æ–¹æ³•æ¥è¿›è¡Œæ“ä½œã€‚

è™½ç„¶ Vue åœ¨æ•°ç»„ä¸Šæä¾›äº†å˜å¼‚æ–¹æ³•ï¼Œä½†å¦‚æœä½ ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼ŒVue æ˜¯æ— æ³•ç›‘å¬åˆ°è¿™ç§å˜åŒ–çš„ã€‚ä¾‹å¦‚ï¼š

```javascript
new Vue({
  data: {
    myArray: [1, 2, 3]
  },
  methods: {
    modifyArray() {
      // è¿™ç§æ–¹å¼ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼ŒVue æ— æ³•æ£€æµ‹åˆ°å˜åŒ–
      this.myArray[0] = 99;
    }
  }
});
```

> ğŸ“Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒVue æä¾›äº† `$set` æ–¹æ³•ï¼Œç”¨äºåœ¨æ•°ç»„æˆ–å¯¹è±¡ä¸­æ·»åŠ æ–°çš„å±æ€§å¹¶ä¿è¯å…¶å“åº”æ€§ã€‚

```javascript
this.$set(this.myArray, 0, 99);
```

æ€»çš„æ¥è¯´ï¼Œè™½ç„¶åœ¨æ•°ç»„å’Œå¯¹è±¡ä¸Šçš„æ•°æ®åŠ«æŒç›¸å¯¹å¤æ‚ï¼Œä½† Vue æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„æœºåˆ¶æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œä»¥ç¡®ä¿åœ¨ä½¿ç”¨æ•°ç»„å’Œå¯¹è±¡æ—¶ä¾ç„¶èƒ½å¤Ÿå®ç°å“åº”å¼ã€‚

## ç›‘æµ‹åŸç†

> ğŸ“Œåœ¨ Vue ä¸­ï¼Œæ•°æ®åŠ«æŒæ˜¯é€šè¿‡ Vue å†…éƒ¨çš„å“åº”å¼ç³»ç»Ÿæ¥å®ç°çš„ã€‚å…·ä½“æ¥è¯´ï¼ŒVue ä½¿ç”¨äº† `Object.defineProperty` æ–¹æ³•æ¥åŠ«æŒå¯¹è±¡çš„å±æ€§ï¼Œä»è€Œå®ç°å¯¹å±æ€§çš„ getter å’Œ setter è¿›è¡Œæ‹¦æˆªï¼Œè¾¾åˆ°ç›‘å¬æ•°æ®å˜åŒ–çš„ç›®çš„ã€‚

åœ¨ Vue çš„å“åº”å¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„å“åº”å¼æ•°æ®å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†ç»„ä»¶çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä½ åœ¨ `data` é€‰é¡¹ä¸­å®šä¹‰çš„æ•°æ®ã€‚è¿™ä¸ªå“åº”å¼æ•°æ®å¯¹è±¡æ˜¯ç”± Vue å†…éƒ¨åˆ›å»ºå’Œç®¡ç†çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œæ¼”ç¤ºäº†æ•°æ®åŠ«æŒçš„åŸºæœ¬åŸç†ï¼š

```javascript
function defineReactive(obj, key, val) {
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: true,
    get: function() {
      console.log(`è®¿é—®äº† ${key}`);
      return val;
    },
    set: function(newVal) {
      console.log(`è®¾ç½®äº† ${key}ï¼Œæ–°å€¼ä¸º ${newVal}`);
      val = newVal;
    }
  });
}

const dataObj = {};
defineReactive(dataObj, 'message', 'Hello, Vue!');

console.log(dataObj.message); // è®¿é—®äº† message
dataObj.message = 'New message'; // è®¾ç½®äº† messageï¼Œæ–°å€¼ä¸º New message
console.log(dataObj.message); // è®¿é—®äº† message
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`defineReactive` å‡½æ•°ç”¨äºåŠ«æŒæ•°æ®å¯¹è±¡çš„å±æ€§ï¼Œé€šè¿‡ `Object.defineProperty` è®¾ç½® `get` å’Œ `set` æ–¹æ³•æ¥ç›‘å¬å±æ€§çš„è®¿é—®å’Œä¿®æ”¹æ“ä½œã€‚

åœ¨ Vue ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± Vue å†…éƒ¨åœ¨ç»„ä»¶å®ä¾‹åŒ–æ—¶è¿›è¡Œçš„ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™è¿™æ ·çš„åŠ«æŒä»£ç ã€‚å½“ä½ åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨ `data` é€‰é¡¹å®šä¹‰æ•°æ®æ—¶ï¼ŒVue ä¼šè‡ªåŠ¨ä¸ºè¿™äº›æ•°æ®è¿›è¡ŒåŠ«æŒï¼Œä»¥å®ç°æ•°æ®çš„å“åº”å¼ã€‚

è¦çœ‹åˆ°æ•°æ®åŠ«æŒçš„è¡¨ç°ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨è®¿é—®æˆ–ä¿®æ”¹æ•°æ®æ—¶åŠ å…¥ `console.log` è¯­å¥ï¼Œè§‚å¯Ÿæ§åˆ¶å°çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨ Vue ç»„ä»¶ä¸­ï¼š

```javascript
new Vue({
  data: {
    message: 'Hello, Vue!'
  },
  created() {
    console.log(this.message); // è®¿é—®äº† message
    this.message = 'New message'; // è®¾ç½®äº† messageï¼Œæ–°å€¼ä¸º New message
    console.log(this.message); // è®¿é—®äº† message
  }
});
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ`console.log` è¯­å¥å°†è¾“å‡ºå¯¹æ•°æ®çš„è®¿é—®å’Œä¿®æ”¹ï¼Œä½ å¯ä»¥é€šè¿‡è¿™äº›è¾“å‡ºæ¥è§‚å¯Ÿåˆ°æ•°æ®åŠ«æŒçš„æ•ˆæœã€‚è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œå®é™…ä¸Š Vue çš„å“åº”å¼ç³»ç»Ÿæ¶‰åŠæ›´å¤šçš„ç»†èŠ‚å’Œä¼˜åŒ–ã€‚

## æ¨¡æ‹Ÿç›‘æµ‹

è¿™ä¸ªåªæ˜¯ä¸€å±‚çš„ï¼Œæ‰€ä»¥æ²¡æœ‰Vueçš„å¥½

```javascript
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <body>
    <script type="text/javascript" >

      let data = {
        name:'èµµæ–°å¤',
        address:'åŒ—äº¬',
      }

      //åˆ›å»ºä¸€ä¸ªç›‘è§†çš„å®ä¾‹å¯¹è±¡ï¼Œç”¨äºç›‘è§†dataä¸­å±æ€§çš„å˜åŒ–
      const obs = new Observer(data)    
      console.log(obs)  

      //å‡†å¤‡ä¸€ä¸ªvmå®ä¾‹å¯¹è±¡
      let vm = {}
      vm._data = data = obs

      function Observer(obj){
        //æ±‡æ€»å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§å½¢æˆä¸€ä¸ªæ•°ç»„
        const keys = Object.keys(obj)
        //éå†
        keys.forEach((k)=>{
          Object.defineProperty(this,k,{
            get(){
              return obj[k]
            },
            set(val){
              console.log(`${k}è¢«æ”¹äº†ï¼Œæˆ‘è¦å»è§£ææ¨¡æ¿ï¼Œç”Ÿæˆè™šæ‹ŸDOM.....æˆ‘è¦å¼€å§‹å¿™äº†`)
              obj[k] = val
            }
          })
        })
      }
    </script>
  </body>
</html>
```

## [å¯¹äºå¯¹è±¡](https://v2.cn.vuejs.org/v2/guide/reactivity.html#å¯¹äºå¯¹è±¡ "å¯¹äºå¯¹è±¡")

é€šè¿‡setterå®ç°ç›‘è§†ï¼Œä¸”è¦åœ¨new Vueæ—¶å°±ä¼ å…¥è¦ç›‘æµ‹çš„æ•°æ®ã€‚

1. å¯¹è±¡ä¸­åè¿½åŠ çš„å±æ€§ï¼ŒVueé»˜è®¤ä¸åšå“åº”å¼å¤„ç†
2. å¦‚éœ€ç»™åæ·»åŠ çš„å±æ€§åšå“åº”å¼ï¼Œè¯·ä½¿ç”¨å¦‚ä¸‹APIï¼š
   - Vue.set(targetï¼ŒpropertyName/indexï¼Œvalue)&#x20;
   - vm.\$set(targetï¼ŒpropertyName/indexï¼Œvalue)

Vue æ— æ³•æ£€æµ‹ property çš„æ·»åŠ æˆ–ç§»é™¤ã€‚ç”±äº Vue ä¼šåœ¨åˆå§‹åŒ–å®ä¾‹æ—¶å¯¹ property æ‰§è¡Œ getter/setter è½¬åŒ–ï¼Œæ‰€ä»¥ property å¿…é¡»åœ¨ `data` å¯¹è±¡ä¸Šå­˜åœ¨æ‰èƒ½è®© Vue å°†å®ƒè½¬æ¢ä¸ºå“åº”å¼çš„ã€‚ä¾‹å¦‚ï¼š

```vue
var vm = new Vue({
  data:{
    a:1
  }
})

// `vm.a` æ˜¯å“åº”å¼çš„

vm.b = 2
// `vm.b` æ˜¯éå“åº”å¼çš„
```

> ğŸ“Œå¯¹äºå·²ç»åˆ›å»ºçš„å®ä¾‹ï¼ŒVue ä¸å…è®¸åŠ¨æ€æ·»åŠ æ ¹çº§åˆ«çš„å“åº”å¼ propertyã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ `Vue.set(object, propertyName, value)` æ–¹æ³•å‘åµŒå¥—å¯¹è±¡æ·»åŠ å“åº”å¼ propertyã€‚ä¾‹å¦‚ï¼Œå¯¹äºï¼š

```vue
Vue.set(vm.someObject, 'b', 2)
```

æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ `vm.$set` å®ä¾‹æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯å…¨å±€ `Vue.set` æ–¹æ³•çš„åˆ«åï¼š

```vue
this.$set(this.someObject,'b',2)
```

æœ‰æ—¶ä½ å¯èƒ½éœ€è¦ä¸ºå·²æœ‰å¯¹è±¡èµ‹å€¼å¤šä¸ªæ–° propertyï¼Œæ¯”å¦‚ä½¿ç”¨ `Object.assign()` æˆ– `_.extend()`ã€‚ä½†æ˜¯ï¼Œè¿™æ ·æ·»åŠ åˆ°å¯¹è±¡ä¸Šçš„æ–° property ä¸ä¼šè§¦å‘æ›´æ–°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ç”¨åŸå¯¹è±¡ä¸è¦æ··åˆè¿›å»çš„å¯¹è±¡çš„ property ä¸€èµ·åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚

```vue
// ä»£æ›¿ `Object.assign(this.someObject, { a: 1, b: 2 })`
this.someObject = Object.assign({}, this.someObject, { a: 1, b: 2 })
```

## Vue.Set

> ğŸ“Œç‰¹åˆ«æ³¨æ„ï¼šVue.set() å’Œ vm.\$set() ä¸èƒ½ç»™vm æˆ– vmçš„æ ¹æ•°æ®å¯¹è±¡æ·»åŠ å±æ€§ï¼ï¼ï¼åªèƒ½ç»™dataä¸­çš„å¯¹è±¡æ·»åŠ å“åº”å¼æ•°æ®ï¼Œä¸å¯ä»¥ç›´æ¥åœ¨dataä¸­æ·»åŠ ã€‚Vmå®ä¾‹ä¸Šçš„å±æ€§ï¼Œä¸€å¼€å§‹æœ‰å‡ ä¸ªï¼Œå°±æ˜¯å‡ ä¸ªï¼Œä¸å¯ä»¥ä½¿ç”¨Vue.setæ·»åŠ ç¬¬å››ä¸ªï¼Œåªèƒ½ç»™å±æ€§ä¸­çš„å¯¹è±¡ä¸­æ·»åŠ å±æ€§

```javascript
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Vueç›‘æµ‹æ•°æ®æ”¹å˜çš„åŸç†</title>
    <!-- å¼•å…¥Vue -->
    <script type="text/javascript" src="../js/vue.js"></script>
  </head>
  <body>
    <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨-->
    <div id="root">
      <h1>å­¦æ ¡ä¿¡æ¯</h1>
      <h2>å­¦æ ¡åç§°ï¼š{{school.name}}</h2>
      <h2>å­¦æ ¡åœ°å€ï¼š{{school.address}}</h2>
      <h2>æ ¡é•¿æ˜¯ï¼š{{school.leader}}</h2>
      <hr/>
      <h1>å­¦ç”Ÿä¿¡æ¯</h1>
      <button @click="addSex">æ·»åŠ ä¸€ä¸ªæ€§åˆ«å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯ç”·</button>
      <h2>å§“åï¼š{{student.name}}</h2>
      <h2 v-if="student.sex">æ€§åˆ«ï¼š{{student.sex}}</h2>
      <h2>å¹´é¾„ï¼šçœŸå®{{student.age.rAge}}ï¼Œå¯¹å¤–{{student.age.sAge}}</h2>
      <h2>æœ‹å‹ä»¬</h2>
      <ul>
        <li v-for="(f,index) in student.friends" :key="index">
          {{f.name}}--{{f.age}}
        </li>
      </ul>
    </div>
  </body>

  <script type="text/javascript">
    Vue.config.productionTip = false //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

    const vm = new Vue({
      el:'#root',
      data:{
        school:{
          name:'å°šç¡…è°·',
          address:'åŒ—äº¬',
        },
        student:{
          name:'tom',
          age:{
            rAge:40,
            sAge:29,
          },
          friends:[
            {name:'jerry',age:35},
            {name:'tony',age:36}
          ]
        }
      },
      methods: {
        addSex(){
          // Vue.set(this.student,'sex','ç”·')
          this.$set(this.student,'sex','ç”·')
        }
      }
    })
  </script>
</html>
```

## [å¯¹äºæ•°ç»„](https://v2.cn.vuejs.org/v2/guide/reactivity.html#å¯¹äºæ•°ç»„ "å¯¹äºæ•°ç»„")

> ğŸ“ŒVueæœ¬èº«å°±æ²¡æœ‰ä¸ºæ•°ç»„æœåŠ¡çš„getterå’Œsetterï¼Œæ”¹äº†ä¹Ÿä¸è®¤

Vue ä¸èƒ½æ£€æµ‹ä»¥ä¸‹æ•°ç»„çš„å˜åŠ¨ï¼š

1. å½“ä½ åˆ©ç”¨ç´¢å¼•ç›´æ¥è®¾ç½®ä¸€ä¸ªæ•°ç»„é¡¹æ—¶ï¼Œä¾‹å¦‚ï¼š`vm.items[indexOfItem] = newValue`
2. å½“ä½ ä¿®æ”¹æ•°ç»„çš„é•¿åº¦æ—¶ï¼Œä¾‹å¦‚ï¼š`vm.items.length = newLength`
3. åœ¨Vueä¿®æ”¹æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´ ä¸€å®šè¦ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š
   1. ä½¿ç”¨è¿™äº›API:push()ã€pop()ã€shift()ã€unshift()ã€splice()ã€sort()ã€reverse()
   2. Vue.set() æˆ– vm.\$set()
   3. ä¸ºä»€ä¹ˆåªæœ‰è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥ï¼Œå› ä¸ºVueå¯¹è¿™äº›æ–¹æ³•è¿›è¡Œäº†åŒ…è£…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å†æ¬¡è°ƒç”¨çš„pushç­‰æ–¹æ³•å·²ç»ä¸æ˜¯Array.prototype.pushäº†
      ![](image/image_QOMgPLSQ6T.png)
4. å¦‚ä½•ç›‘æµ‹æ•°ç»„ä¸­çš„æ•°æ®ï¼Ÿ
   &#x20;  é€šè¿‡åŒ…è£¹æ•°ç»„æ›´æ–°å…ƒç´ çš„æ–¹æ³•å®ç°ï¼Œæœ¬è´¨å°±æ˜¯åšäº†ä¸¤ä»¶äº‹ï¼š
   &#x20;  (1).è°ƒç”¨åŸç”Ÿå¯¹åº”çš„æ–¹æ³•å¯¹æ•°ç»„è¿›è¡Œæ›´æ–°ã€‚
   &#x20;  (2).é‡æ–°è§£ææ¨¡æ¿ï¼Œè¿›è€Œæ›´æ–°é¡µé¢ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```vue
var vm = new Vue({
  data: {
    items: ['a', 'b', 'c']
  }
})
vm.items[1] = 'x' // ä¸æ˜¯å“åº”æ€§çš„
vm.items.length = 2 // ä¸æ˜¯å“åº”æ€§çš„
```

ä¸ºäº†è§£å†³ç¬¬ä¸€ç±»é—®é¢˜ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥å®ç°å’Œ `vm.items[indexOfItem] = newValue` ç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿå°†åœ¨å“åº”å¼ç³»ç»Ÿå†…è§¦å‘çŠ¶æ€æ›´æ–°ï¼š

```vue
// Vue.set
Vue.set(vm.items, indexOfItem, newValue)
```

```vue
// Array.prototype.splice
vm.items.splice(indexOfItem, 1, newValue)
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [vm.\$set](https://v2.cn.vuejs.org/v2/api/#vm-set "vm.\$set") å®ä¾‹æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯å…¨å±€æ–¹æ³• `Vue.set` çš„ä¸€ä¸ªåˆ«åï¼š

```vue
vm.$set(vm.items, indexOfItem, newValue)
```

ä¸ºäº†è§£å†³ç¬¬äºŒç±»é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ `splice`ï¼š

```vue
vm.items.splice(newLength)
```

## å“åº”å¼ property

> ğŸ“Œç”±äº Vue ä¸å…è®¸åŠ¨æ€æ·»åŠ æ ¹çº§å“åº”å¼ propertyï¼Œæ‰€ä»¥ä½ å¿…é¡»åœ¨åˆå§‹åŒ–å®ä¾‹å‰å£°æ˜æ‰€æœ‰æ ¹çº§å“åº”å¼ propertyï¼Œå“ªæ€•åªæ˜¯ä¸€ä¸ªç©ºå€¼

```vue
var vm = new Vue({
  data: {
    // å£°æ˜ message ä¸ºä¸€ä¸ªç©ºå€¼å­—ç¬¦ä¸²
    message: ''
  },
  template: '<div>{{ message }}</div>'
})
// ä¹‹åè®¾ç½® `message`
vm.message = 'Hello!'
```

å¦‚æœä½ æœªåœ¨ `data` é€‰é¡¹ä¸­å£°æ˜ `message`ï¼ŒVue å°†è­¦å‘Šä½ æ¸²æŸ“å‡½æ•°æ­£åœ¨è¯•å›¾è®¿é—®ä¸å­˜åœ¨çš„ propertyã€‚

è¿™æ ·çš„é™åˆ¶åœ¨èƒŒåæ˜¯æœ‰å…¶æŠ€æœ¯åŸå› çš„ï¼Œå®ƒæ¶ˆé™¤äº†åœ¨ä¾èµ–é¡¹è·Ÿè¸ªç³»ç»Ÿä¸­çš„ä¸€ç±»è¾¹ç•Œæƒ…å†µï¼Œä¹Ÿä½¿ Vue å®ä¾‹èƒ½æ›´å¥½åœ°é…åˆç±»å‹æ£€æŸ¥ç³»ç»Ÿå·¥ä½œã€‚ä½†ä¸æ­¤åŒæ—¶åœ¨ä»£ç å¯ç»´æŠ¤æ€§æ–¹é¢ä¹Ÿæœ‰ä¸€ç‚¹é‡è¦çš„è€ƒè™‘ï¼š`data` å¯¹è±¡å°±åƒç»„ä»¶çŠ¶æ€çš„ç»“æ„ (schema)ã€‚æå‰å£°æ˜æ‰€æœ‰çš„å“åº”å¼ propertyï¼Œå¯ä»¥è®©ç»„ä»¶ä»£ç åœ¨æœªæ¥ä¿®æ”¹æˆ–ç»™å…¶ä»–å¼€å‘äººå‘˜é˜…è¯»æ—¶æ›´æ˜“äºç†è§£ã€‚

```html
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>æ€»ç»“æ•°æ®ç›‘è§†</title>
  <style>
    button {
      margin-top: 10px;
    }
  </style>
  <!-- å¼•å…¥Vue -->
  <script type="text/javascript" src="../js/vue.js"></script>
</head>

<body>
  <!-- å‡†å¤‡å¥½ä¸€ä¸ªå®¹å™¨-->
  <div id="root">
    <h1>å­¦ç”Ÿä¿¡æ¯</h1>
    <button @click="student.age++">å¹´é¾„+1å²</button> <br />
    <button @click="addSex">æ·»åŠ æ€§åˆ«å±æ€§ï¼Œé»˜è®¤å€¼ï¼šç”·</button> <br />
    <button @click="student.sex = 'æœªçŸ¥' ">ä¿®æ”¹æ€§åˆ«</button> <br />
    <button @click="addFriend">åœ¨åˆ—è¡¨é¦–ä½æ·»åŠ ä¸€ä¸ªæœ‹å‹</button> <br />
    <button @click="updateFirstFriendName">ä¿®æ”¹ç¬¬ä¸€ä¸ªæœ‹å‹çš„åå­—ä¸ºï¼šå¼ ä¸‰</button> <br />
    <button @click="addHobby">æ·»åŠ ä¸€ä¸ªçˆ±å¥½</button> <br />
    <button @click="updateHobby">ä¿®æ”¹ç¬¬ä¸€ä¸ªçˆ±å¥½ä¸ºï¼šå¼€è½¦</button> <br />
    <button @click="removeSmoke">è¿‡æ»¤æ‰çˆ±å¥½ä¸­çš„æŠ½çƒŸ</button> <br />
    <h3>å§“åï¼š{{student.name}}</h3>
    <h3>å¹´é¾„ï¼š{{student.age}}</h3>
    <h3 v-if="student.sex">æ€§åˆ«ï¼š{{student.sex}}</h3>
    <h3>çˆ±å¥½ï¼š</h3>
    <ul>
      <li v-for="(h,index) in student.hobby" :key="index">
        {{h}}
      </li>
    </ul>
    <h3>æœ‹å‹ä»¬ï¼š</h3>
    <ul>
      <li v-for="(f,index) in student.friends" :key="index">
        {{f.name}}--{{f.age}}
      </li>
    </ul>
  </div>
</body>

<script type="text/javascript">
  Vue.config.productionTip = false //é˜»æ­¢ vue åœ¨å¯åŠ¨æ—¶ç”Ÿæˆç”Ÿäº§æç¤ºã€‚

  const vm = new Vue({
    el: '#root',
    data: {
      student: {
        name: 'tom',
        age: 18,
        hobby: ['æŠ½çƒŸ', 'å–é…’', 'çƒ«å¤´'],
        friends: [
          { name: 'jerry', age: 35 },
          { name: 'tony', age: 36 }
        ]
      }
    },
    methods: {
      addSex() {
        // Vue.set(this.student,'sex','ç”·')
        this.$set(this.student, 'sex', 'ç”·')
      },
      addFriend() {
        this.student.friends.unshift({ name: 'jack', age: 70 })
      },
      updateFirstFriendName() {
        this.student.friends[0].name = 'å¼ ä¸‰'
      },
      addHobby() {
        this.student.hobby.push('å­¦ä¹ ')
      },
      updateHobby() {
        // this.student.hobby.splice(0,1,'å¼€è½¦')
        // Vue.set(this.student.hobby,0,'å¼€è½¦')
        this.$set(this.student.hobby, 0, 'å¼€è½¦')
      },
      removeSmoke() {
        this.student.hobby = this.student.hobby.filter((h) => {
          return h !== 'æŠ½çƒŸ'
        })
      }
    }
  })
</script>

</html>
```

## [å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—](https://v2.cn.vuejs.org/v2/guide/reactivity.html#å¼‚æ­¥æ›´æ–°é˜Ÿåˆ— "å¼‚æ­¥æ›´æ–°é˜Ÿåˆ—")

å¯èƒ½ä½ è¿˜æ²¡æœ‰æ³¨æ„åˆ°ï¼ŒVue åœ¨æ›´æ–° DOM æ—¶æ˜¯**å¼‚æ­¥**æ‰§è¡Œçš„ã€‚åªè¦ä¾¦å¬åˆ°æ•°æ®å˜åŒ–ï¼ŒVue å°†å¼€å¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¹¶ç¼“å†²åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­å‘ç”Ÿçš„æ‰€æœ‰æ•°æ®å˜æ›´ã€‚å¦‚æœåŒä¸€ä¸ª watcher è¢«å¤šæ¬¡è§¦å‘ï¼Œåªä¼šè¢«æ¨å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸€æ¬¡ã€‚è¿™ç§åœ¨ç¼“å†²æ—¶å»é™¤é‡å¤æ•°æ®å¯¹äºé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ“ä½œæ˜¯éå¸¸é‡è¦çš„ã€‚ç„¶åï¼Œåœ¨ä¸‹ä¸€ä¸ªçš„äº‹ä»¶å¾ªç¯â€œtickâ€ä¸­ï¼ŒVue åˆ·æ–°é˜Ÿåˆ—å¹¶æ‰§è¡Œå®é™… (å·²å»é‡çš„) å·¥ä½œã€‚Vue åœ¨å†…éƒ¨å¯¹å¼‚æ­¥é˜Ÿåˆ—å°è¯•ä½¿ç”¨åŸç”Ÿçš„ `Promise.then`ã€`MutationObserver` å’Œ `setImmediate`ï¼Œå¦‚æœæ‰§è¡Œç¯å¢ƒä¸æ”¯æŒï¼Œåˆ™ä¼šé‡‡ç”¨ `setTimeout(fn, 0)` ä»£æ›¿ã€‚

ä¾‹å¦‚ï¼Œå½“ä½ è®¾ç½® `vm.someData = 'new value'`ï¼Œè¯¥ç»„ä»¶ä¸ä¼šç«‹å³é‡æ–°æ¸²æŸ“ã€‚å½“åˆ·æ–°é˜Ÿåˆ—æ—¶ï¼Œç»„ä»¶ä¼šåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯â€œtickâ€ä¸­æ›´æ–°ã€‚å¤šæ•°æƒ…å†µæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³åŸºäºæ›´æ–°åçš„ DOM çŠ¶æ€æ¥åšç‚¹ä»€ä¹ˆï¼Œè¿™å°±å¯èƒ½ä¼šæœ‰äº›æ£˜æ‰‹ã€‚è™½ç„¶ Vue.js é€šå¸¸é¼“åŠ±å¼€å‘äººå‘˜ä½¿ç”¨â€œæ•°æ®é©±åŠ¨â€çš„æ–¹å¼æ€è€ƒï¼Œé¿å…ç›´æ¥æ¥è§¦ DOMï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬å¿…é¡»è¦è¿™ä¹ˆåšã€‚ä¸ºäº†åœ¨æ•°æ®å˜åŒ–ä¹‹åç­‰å¾… Vue å®Œæˆæ›´æ–° DOMï¼Œå¯ä»¥åœ¨æ•°æ®å˜åŒ–ä¹‹åç«‹å³ä½¿ç”¨ `Vue.nextTick(callback)`ã€‚è¿™æ ·å›è°ƒå‡½æ•°å°†åœ¨ DOM æ›´æ–°å®Œæˆåè¢«è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š

```vue
<div id="example">{{message}}</div>
```

```vue
var vm = new Vue({
  el: '#example',
  data: {
    message: '123'
  }
})
vm.message = 'new message' // æ›´æ”¹æ•°æ®
vm.$el.textContent === 'new message' // false
Vue.nextTick(function () {
  vm.$el.textContent === 'new message' // true
})
```

åœ¨ç»„ä»¶å†…ä½¿ç”¨ `vm.$nextTick()` å®ä¾‹æ–¹æ³•ç‰¹åˆ«æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å…¨å±€ `Vue`ï¼Œå¹¶ä¸”å›è°ƒå‡½æ•°ä¸­çš„ `this` å°†è‡ªåŠ¨ç»‘å®šåˆ°å½“å‰çš„ Vue å®ä¾‹ä¸Šï¼š

```vue
Vue.component('example', {
  template: '<span>{{ message }}</span>',
  data: function () {
    return {
      message: 'æœªæ›´æ–°'
    }
  },
  methods: {
    updateMessage: function () {
      this.message = 'å·²æ›´æ–°'
      console.log(this.$el.textContent) // => 'æœªæ›´æ–°'
      this.$nextTick(function () {
        console.log(this.$el.textContent) // => 'å·²æ›´æ–°'
      })
    }
  }
})
```

å› ä¸º `$nextTick()` è¿”å›ä¸€ä¸ª `Promise` å¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨æ–°çš„ [ES2017 async/await](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function "ES2017 async/await") è¯­æ³•å®Œæˆç›¸åŒçš„äº‹æƒ…ï¼š

```vue
methods: {
  updateMessage: async function () {
    this.message = 'å·²æ›´æ–°'
    console.log(this.$el.textContent) // => 'æœªæ›´æ–°'
    await this.$nextTick()
    console.log(this.$el.textContent) // => 'å·²æ›´æ–°'
  }
}
```
